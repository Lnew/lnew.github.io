[{"title":"åœ¨ä¸€ç»„æ•°ä¸­ï¼Œæ‰¾ç»™å®šå€¼Targetæœ€è¿‘çš„kä¸ªæ•°","url":"/tech-notes/php-1563875831.html","content":"#### å·²çŸ¥ä¸€ç»„å‡åºæ•°ç»„ï¼Œæ±‚ä¸targetæœ€æ¥è¿‘çš„kä¸ªæ•°\n````\nfunction suanfa($arr,$target,$k){\n    if($arr==0||count($arr)==0){\n        return $arr;\n    }\n    $length = count($arr);\n    if($k>=$length){\n        return $arr;\n    }\n\n    //è·å–æœ€è¿‘ç´¢å¼•\n    $start = 0;\n    $end = $length - 1;\n    while ($start + 1 < $end){\n        $mid = $start + ($end - $start) / 2;\n        if ($arr[$mid] < $target) {\n            $start = $mid;\n        } else {\n            $end = $mid;\n        }\n    }\n    if ($target - $arr[$start] <= $arr[$end] - $target) {\n        $index = $start;\n    }else{\n        $index = $end;\n    }\n\n\n    $left = $index;\n    $right = $index+1;\n    $result=[];\n    //åŒæŒ‡é’ˆï¼Œä¸¤ä¸ªåå‘æŒ‡é’ˆ\n    for ($i = 0; $i < $k; $i++) {\n        //è¶Šç•Œ\n        if ($left < 0) {\n            $result[$i] = $arr[$right++];\n        } else if ($right >= $length) {  //è¶Šç•Œ\n            $result[$i] = $arr[$left--];\n        } else {\n            if ($target-$arr[$left] <= $arr[$right]-$target) {\n                $result[$i] = $arr[$left--];\n            } else {\n                $result[$i] = $arr[$right++];\n            }\n        }\n    }\n    return $result;\n}\n\n$arr = [1,2,3,4,5,6,7,8,9];\n$target = 4;\n$k = 3;\n$result = suanfa($arr,$target,$k);\nprint_r($result);\n````\n","tags":["Php"],"categories":["éšç¬”"]},{"title":"Pandaså¤„ç†csvæ•°æ®å…¥åº“äºŒ","url":"/tech-notes/pandas-1563334142.html","content":"\n#### python ç¯å¢ƒ-Anaconda 5.2.0\n#### ç›®å½•ç»“æ„\n- sh201001d\n    - 20100104\n        - 600000_20100104.csv\n    - 20100105\n        - 600000_20100105.csv\n    - 20100106\n        - 600000_20100106.csv\n        \n\n````\n# -*- coding: utf-8 -*-\nimport os\n\nimport pandas as pd\n\nfrom sqlalchemy import create_engine\n\n#æ˜¾ç¤ºæ‰€æœ‰åˆ—\n#pd.set_option('display.max_columns', None)\n#æ˜¾ç¤ºæ‰€æœ‰è¡Œ\n#pd.set_option('display.max_rows', None)\npd.set_option('display.float_format',lambda x : '%.2f' % x)\n\nfile_dir = \"D:\\\\BaiduNetdiskDownload\\\\2008-2018\\\\tick2010d\\\\sh201001d\"\nprefix = 'sh'\n# æ•°æ®åº“\nengine = create_engine('mysql+pymysql://root:@localhost:3306/gp_minute?charset=utf8&autocommit=true',echo=True)\n# è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å\ndef file_name(file_dir):\n    file_list= [([]) for i in range(2)]\n    for root,dirs,files in os.walk(file_dir):\n        if files:\n            file_list[0].append(root)\n            file_list[1].append(files)\n    return file_list\n    \nfiles = file_name(file_dir)\n#file = 'sh600000.csv'\nfor index in range(0,len(files[0])):\n    for file in files[1][index]:\n        table_name = prefix+file.split('_')[0]\n        raw = pd.read_csv('%s\\\\%s'%(files[0][index],file),names=['æ—¶é—´','æˆäº¤ç¬”æ•°','æˆäº¤é¢','æˆäº¤é‡','æ–¹å‘'],encoding='GBK', skiprows=1,usecols=[2,4,5,6,7],header=None)\n        raw['æ—¶é—´'] = pd.to_datetime(raw['æ—¶é—´']).dt.strftime('%Y%m%d%H%M')\n        raw['æˆäº¤é‡'] = raw['æˆäº¤é‡']*100\n        #print(raw.head())\n        # è·å–åˆ†ç»„æ—¶é—´\n        result = raw.groupby(raw['æ—¶é—´']).size().reset_index().drop(columns=[0])\n        result.columns = ['s_datemin']\n        # è®¡ç®—ä»·æ ¼å¹³å‡å€¼--å»æ‰æˆäº¤é‡ä¸ºé›¶çš„è¡Œ\n        s_price = raw.loc[raw['æˆäº¤é‡']!=0]\n        s_price = (s_price['æˆäº¤é¢'].groupby(s_price['æ—¶é—´']).mean()/(s_price['æˆäº¤é‡']).groupby(s_price['æ—¶é—´']).mean()).reset_index(name='å‡æˆäº¤é¢')\n        s_price.columns = ['s_datemin','s_price']\n        #print(s_price[:5])\n        # åˆ†å‰²--B\n        b_result = raw.loc[raw['æ–¹å‘']=='B']\n        b_result = (b_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(b_result['æ—¶é—´']).sum()).reset_index()\n        #print(b_result[:5])\n        b_result.columns = ['s_datemin','s_bvalue','s_bshou','s_bci']\n        # åˆ†å‰²--S\n        s_result = raw.loc[raw['æ–¹å‘']=='S']\n        s_result = (s_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(s_result['æ—¶é—´']).sum()).reset_index()\n        #print(s_result[:5])\n        s_result.columns = ['s_datemin','s_svalue','s_sshou','s_sci']\n        # åˆ†å‰²--Z\n        z_result = raw.loc[~raw['æ–¹å‘'].isin(['B','S'])]\n        z_result = (z_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(z_result['æ—¶é—´']).sum()).reset_index()\n        #print(z_result[:5])\n        z_result.columns = ['s_datemin','s_zvalue','s_zshou','s_zci']\n        #åˆå¹¶æ•°æ®\n        info = pd.merge(result,s_price,on='s_datemin',how='left')\n        info = pd.merge(info,b_result,on='s_datemin',how='left')\n        info = pd.merge(info,s_result,on='s_datemin',how='left')\n        info = pd.merge(info,z_result,on='s_datemin',how='left')\n        info.fillna(0,inplace=True)\n        info.ix[info['s_price'].isin(['inf']),'s_price']=0\n        info['s_price'] = info['s_price'].round(2)\n        # åˆ›å»ºæ•°æ®åº“\n        #### æ£€æµ‹æ•°æ®åº“æ˜¯å¦å­˜åœ¨\n        #table_name = file[:-4]\n        sql = 'SELECT table_name FROM information_schema.TABLES WHERE table_name = \"%s\"'%(table_name)\n        df = pd.read_sql_query(sql, engine)\n        if df.empty:\n            sql = '''\n            CREATE TABLE `%s` (\n              `s_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®è‡ªå¢',\n              `s_datemin` bigint(20) NULL COMMENT 'åˆ†é’Ÿ 201901010930 å”¯ä¸€',\n              `s_price` float(8,2) NULL COMMENT 'ä»·æ ¼ï¼Œæœ¬åˆ†é’Ÿä»·æ ¼å¹³å‡å€¼',\n              `s_bvalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿä¹°å…¥é‡‘é¢ï¼Œå•ä½å…ƒ',\n              `s_bshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†ä¹°å…¥è‚¡ç¥¨æ•° å•ä½è‚¡',\n              `s_bci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¹°å…¥äº¤æ˜“æ¬¡æ•°',\n              `s_svalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ å–åœºä»·å€¼ å•ä½å…ƒ',\n              `s_sshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿå–å‡º è‚¡ç¥¨æ•°',\n              `s_sci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†å–å‡ºäº¤æ˜“æ¬¡æ•°',\n              `s_zvalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¸­æ€§æˆäº¤é‡‘é¢ å•ä½å…ƒ',\n              `s_zshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿä¸­æ€§ è‚¡æ•°',\n              `s_zci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¸­æ€§äº¤æ˜“æ¬¡æ•°',\n               PRIMARY KEY (`s_id`),\n               UNIQUE KEY `s_datem` (`s_datemin`)\n            ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='è‚¡ç¥¨å†å²æ¯åˆ†é’Ÿäº¤æ˜“æ¬¡åŠäº¤æ˜“é‡' AUTO_INCREMENT=1 ;\n            '''%(table_name)\n            engine.execute(sql)\n        #else:\n            #sql = 'alter table `%s` modify column `s_bvalue` bigint(20),modify column `s_svalue` bigint(20),modify column `s_zvalue` bigint(20);'%(table_name)\n            #engine.execute(sql)\n        pd.io.sql.to_sql(info,table_name,con=engine,if_exists='append', index=False, chunksize=10000)\n        ## åˆ é™¤å·²æ‰§è¡Œæ–‡ä»¶\n        os.remove('%s\\\\%s'%(files[0][index],file))\n````\n","tags":["Python"],"categories":["éšç¬”"]},{"title":"åˆç”¨Pandasæ“ä½œè®°å½•","url":"/tech-notes/pandas-1562901077.html","content":"#### python ç¯å¢ƒ-Anaconda 5.2.0\n\n#### ç›®å½•ç»“æ„\n- sz2008tick3\n    - sh600000.csv\n    - sh600001.csv\n    - sh600002.csv\n\n\n````\n# -*- coding: utf-8 -*-\nimport os\n\nimport pandas as pd\n\nfrom sqlalchemy import create_engine\n\n#æ˜¾ç¤ºæ‰€æœ‰åˆ—\n#pd.set_option('display.max_columns', None)\n#æ˜¾ç¤ºæ‰€æœ‰è¡Œ\n#pd.set_option('display.max_rows', None)\npd.set_option('display.float_format',lambda x : '%.2f' % x)\n\nfile_dir = \"D:\\\\BaiduNetdiskDownload\\\\2008-2018\\\\tick2008y\\\\sz2008tick3\"\n# æ•°æ®åº“\nengine = create_engine('mysql+pymysql://root:@localhost:3306/gp_minute?charset=utf8&autocommit=true',echo=True)\n# è·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶å\ndef file_name(file_dir):\n    for root,dirs,files in os.walk(file_dir):\n        return files\n\nfiles = file_name(file_dir)\nfor file in files:\n    # è¯»å–csvæ•°æ®\n    raw = pd.read_csv('%s\\\\%s'%(file_dir,file),names=['æ—¶é—´','æˆäº¤ç¬”æ•°','æˆäº¤é¢','æˆäº¤é‡','æ–¹å‘'],encoding='GBK', skiprows=1,usecols=[2,4,5,6,7],header=None)\n    # æ ¼å¼åŒ–æ—¶é—´ä¸ºéœ€è¦æ ¼å¼\n    raw['æ—¶é—´'] = pd.to_datetime(raw['æ—¶é—´']).dt.strftime('%Y%m%d%H%M')\n    # ä¿®æ”¹å•ä½\n    raw['æˆäº¤é‡'] = raw['æˆäº¤é‡']*100\n    #print(raw.head())\n    # è·å–åˆ†ç»„æ—¶é—´\n    result = raw.groupby(raw['æ—¶é—´']).size().reset_index().drop(columns=[0])\n    result.columns = ['s_datemin']\n    # è®¡ç®—ä»·æ ¼å¹³å‡å€¼--å»æ‰æˆäº¤é‡ä¸ºé›¶çš„è¡Œ\n    s_price = raw.loc[raw['æˆäº¤é‡']!=0]\n    s_price = (s_price['æˆäº¤é¢'].groupby(s_price['æ—¶é—´']).mean()/(s_price['æˆäº¤é‡']).groupby(s_price['æ—¶é—´']).mean()).reset_index(name='å‡æˆäº¤é¢')\n    s_price.columns = ['s_datemin','s_price']\n    #print(s_price[:5])\n    # åˆ†å‰²--B\n    b_result = raw.loc[raw['æ–¹å‘']=='B']\n    b_result = (b_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(b_result['æ—¶é—´']).sum()).reset_index()\n    #print(b_result[:5])\n    b_result.columns = ['s_datemin','s_bvalue','s_bshou','s_bci']\n    # åˆ†å‰²--S\n    s_result = raw.loc[raw['æ–¹å‘']=='S']\n    s_result = (s_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(s_result['æ—¶é—´']).sum()).reset_index()\n    #print(s_result[:5])\n    s_result.columns = ['s_datemin','s_svalue','s_sshou','s_sci']\n    # åˆ†å‰²--Z\n    z_result = raw.loc[~raw['æ–¹å‘'].isin(['B','S'])]\n    z_result = (z_result[['æˆäº¤é¢','æˆäº¤é‡','æˆäº¤ç¬”æ•°']].groupby(z_result['æ—¶é—´']).sum()).reset_index()\n    #print(z_result[:5])\n    z_result.columns = ['s_datemin','s_zvalue','s_zshou','s_zci']\n    #åˆå¹¶æ•°æ®\n    info = pd.merge(result,s_price,on='s_datemin',how='left')\n    info = pd.merge(info,b_result,on='s_datemin',how='left')\n    info = pd.merge(info,s_result,on='s_datemin',how='left')\n    info = pd.merge(info,z_result,on='s_datemin',how='left')\n    info.fillna(0,inplace=True)\n    info.ix[info['s_price'].isin(['inf']),'s_price']=0\n    info['s_price'] = info['s_price'].round(2)\n    # åˆ›å»ºæ•°æ®åº“\n    #### æ£€æµ‹æ•°æ®åº“æ˜¯å¦å­˜åœ¨\n    table_name = file[:-4]\n    sql = 'SELECT table_name FROM information_schema.TABLES WHERE table_name = \"%s\"'%(table_name)\n    df = pd.read_sql_query(sql, engine)\n    if df.empty:\n        sql = '''\n        CREATE TABLE `%s` (\n          `s_id` int(11) NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®è‡ªå¢',\n          `s_datemin` bigint(20) NULL COMMENT 'åˆ†é’Ÿ 201901010930 å”¯ä¸€',\n          `s_price` float(8,2) NULL COMMENT 'ä»·æ ¼ï¼Œæœ¬åˆ†é’Ÿä»·æ ¼å¹³å‡å€¼',\n          `s_bvalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿä¹°å…¥é‡‘é¢ï¼Œå•ä½å…ƒ',\n          `s_bshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†ä¹°å…¥è‚¡ç¥¨æ•° å•ä½è‚¡',\n          `s_bci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¹°å…¥äº¤æ˜“æ¬¡æ•°',\n          `s_svalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ å–åœºä»·å€¼ å•ä½å…ƒ',\n          `s_sshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿå–å‡º è‚¡ç¥¨æ•°',\n          `s_sci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†å–å‡ºäº¤æ˜“æ¬¡æ•°',\n          `s_zvalue` bigint(20) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¸­æ€§æˆäº¤é‡‘é¢ å•ä½å…ƒ',\n          `s_zshou` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿä¸­æ€§ è‚¡æ•°',\n          `s_zci` int(11) NULL DEFAULT '0' COMMENT 'æœ¬åˆ†é’Ÿ ä¸­æ€§äº¤æ˜“æ¬¡æ•°',\n           PRIMARY KEY (`s_id`),\n           UNIQUE KEY `s_datem` (`s_datemin`)\n        ) ENGINE=InnoDB  DEFAULT CHARSET=utf8 COMMENT='è‚¡ç¥¨å†å²æ¯åˆ†é’Ÿäº¤æ˜“æ¬¡åŠäº¤æ˜“é‡' AUTO_INCREMENT=1 ;\n        '''%(table_name)\n        engine.execute(sql)\n    else:\n        sql = 'alter table `%s` modify column `s_bvalue` bigint(20),modify column `s_svalue` bigint(20),modify column `s_zvalue` bigint(20);'%(table_name)\n        engine.execute(sql)\n    pd.io.sql.to_sql(info,table_name,con=engine,if_exists='append', index=False, chunksize=10000)\n    ## åˆ é™¤å·²æ‰§è¡Œæ–‡ä»¶\n    os.remove('%s\\\\%s'%(file_dir,file))\n````\n","tags":["Python"],"categories":["éšç¬”"]},{"title":"Mysqlä¸»ä»åŒæ­¥ç¬¬äºŒç¯‡","url":"/tech-notes/mysql-1562661148.html","content":"#### æˆ‘é‡åˆ°çš„é—®é¢˜\n- ç¬¬ä¸€æ¬¡é…å¥½åï¼Œå°‘å¤‡ä»½äº†ä¸€ä¸ªè¡¨ï¼Œç„¶åæŠ¥é”™äº†\n    - æˆ‘çš„æ–¹æ³•æ—¶æ–°å»ºè¡¨ï¼Œç»“æœæœ‰äº†æ›´å¤šé”™è¯¯\n    - ç”±äºè¡¨å¤ªå¤šï¼Œæœ€åé‡åšäº†ï¼\n- ç¬¬äºŒæ¬¡å¸å–æ•™è®­ï¼Œç”¨é‚£å‡ ä¸ªè¡¨ï¼ŒåŒæ­¥é‚£å‡ ä¸ªï¼Œåœ¨ä»æ•°æ®åº“é…ç½®ï¼šreplicate_wild_do_table=\n    - è¿™é‡Œé‡åˆ°å¤§å‘ï¼Œçœ‹ç½‘ä¸Šè¯´æ˜¯ç”¨é‚£å‡ ä¸ªè¡¨ï¼Œè¡¨åä¹‹é—´é€—å·éš”å¼€\n    - é…å¥½åï¼Œä¸€åˆ‡æ­£å¸¸ï¼Œè¿‡äº†ä¸€ä¼šå‘ç°è™½ç„¶è¿è¡Œæ­£å¸¸ï¼Œä½†å°±æ˜¯è¡¨æ²¡æœ‰å˜åŒ–\n    - åœ¨ç½‘ä¸Šæ‰¾äº†å¥½å¤šæ–¹æ³•ï¼Œéƒ½ä¸ç®¡ç”¨\n    - æŠ±ç€æ­»çš„å¿ƒç†ï¼Œæˆ‘æŠŠé…ç½®é‡å†™äº†ä¸‹ï¼Œä¸å†æ˜¯replicate_wild_do_table=db.t1,db.t2è¿™ç§\n    - æ”¹æˆäº† replicate_wild_do_table=db.t1  æ¢è¡Œ replicate_wild_do_table=db.t2\n    - å¥‡è¿¹å‘ç”Ÿäº†ï¼Œå¯ä»¥äº†ï¼ˆæˆ‘çŒœæƒ³ç¬¬ä¸€æ¬¡åº”è¯¥æ˜¯æŠŠ`[db.t1,db.t2]`æ•´ä½“çœ‹æˆè¡¨åäº†ï¼‰ğŸ˜­\n- æ¥ä¸‹æ¥æˆ‘å‘ç°æ•°æ®æœ‰äº†ç¼ºå¤±ï¼Œæˆ‘åˆä¸æƒ³é‡æ–°æä¸»æ•°æ®åº“\n    - æƒ³åˆ°ä¸Šæ¬¡é‡åˆ°ä¸»é”®å†²çªçš„é”™è¯¯\n    - åœæ­¢ STOP SLAVE;\n    - é‡ç½® reset master; reset slave all  éƒ½åœ¨ä»æ•°æ®åº“æ“ä½œ\n    - å……è®¾äº‹åŠ¡å· SET SESSION GTID_NEXT = AUTOMATIC;\n    - ç›´æ¥æŠŠä¸»æ•°æ®åº“ç°åœ¨çš„è¡¨å¯¼å…¥åˆ°ä»æ•°æ®åº“\n    - ``CHANGE MASTER TO\n                    MASTER_HOST='',\n                    MASTER_USER='',\n                    MASTER_PASSWORD='',\n                    MASTER_PORT=3306,\n                    MASTER_LOG_FILE='mysql-bin.000001',\n                    MASTER_LOG_POS=0,  è¿™é‡Œä¸€å®šè¦ä»å¤´å¼€å§‹\n                    MASTER_CONNECT_RETRY=10;``\n    - å¼€å¯ start slave;\n    - ç„¶åæŸ¥çœ‹ SHOW SLAVE STATUS;\n    - æœä¸å…¶ç„¶ï¼Œæœ‰äº†ä¸»é”®å†²çª\n    - è®°ä½æç¤ºçš„ä¸»é”®å€¼ï¼Œç„¶ååœ¨è¡¨é‡Œåˆ é™¤å¤§äºç­‰äºçš„æ‰€æœ‰æ•°æ®\n    - åœæ­¢ STOP SLAVE;å¼€å¯ start slave;\n- è‡³æ­¤æ•°æ®åŒæ­¥å•¦ï¼ï¼ï¼","tags":["Mysql"],"categories":["éšç¬”"]},{"title":"Mysqlä¸»ä»åŒæ­¥","url":"/tech-notes/mysql-1561613758.html","content":"#### æ•´ç†äº†ä¸‹å„ç¯å¢ƒmysqlä¸»ä»åŒæ­¥çš„é…ç½®æ–¹æ³•\n\n> 2ä¸ªMySQLæœåŠ¡é…ç½®ä¸»ä»\n````\n#####ä¸»æ•°æ®åº“é…ç½®\nåœ¨[mysqld]é…ç½®æ®µæ·»åŠ å¦‚ä¸‹å­—æ®µ\n\nserver-id=1\nlog-bin=mysql-bin\nlog-slave-updates=1\nbinlog-do-db=  #éœ€è¦åŒæ­¥çš„æ•°æ®åº“,å¦‚æœæ²¡æœ‰æœ¬è¡Œè¡¨ç¤ºåŒæ­¥æ‰€æœ‰çš„æ•°æ®åº“\nbinlog-ignore-db=mysql  #è¢«å¿½ç•¥çš„æ•°æ®\ninnodb-file-per-table =ON\nskip_name_resolve=ON\n\nåœ¨masteræœºä¸Šä¸ºslaveæœºæ·»åŠ ä¸€åŒæ­¥å¸å·\n mysql>grant replication slave on *.* to 'ç”¨æˆ·'@'ä»æ•°æ®åº“åœ°å€' identified by 'å¯†ç ';\n mysql>flush  privileges;\né‡å¯mysqlæœåŠ¡\næŸ¥çœ‹æ—¥å¿—æƒ…å†µ\nshow master logs\n|Log_name|File_size|\n|--------|---------|\n|mysql-bin.000016|177|\n|mysql-bin.000017|121680|\n|mysql-bin.000018|201|\n# è®°ä½æœ€åä¸€è¡Œï¼Œä»æœåŠ¡å™¨å¼€å¯åŒæ­¥è¦ç”¨åˆ°\n\n#####ä»æ•°æ®åº“é…ç½®\nåŒæ ·åœ¨[mysqld]å­—æ®µä¸‹æ·»åŠ å¦‚ä¸‹å†…å®¹\n\nserver-id=2\nrelay-log= mysql-relay-bin\nread-only=1\nlog-slave-updates=1\nreplicate-do-db= #è¦åŒæ­¥çš„æ•°æ®åº“,ä¸å†™æœ¬è¡Œè¡¨ç¤ºåŒæ­¥æ‰€æœ‰æ•°æ®åº“\nreplicate-do-table= #è¦åŒæ­¥çš„è¡¨\ninnodb_file_per_table=ON\nskip_name_resolve=ON\né‡å¯mysqlæœåŠ¡\n#####ä»æ•°æ®åº“æ‰§è¡Œå‘½ä»¤\nCHANGE MASTER TO\nMASTER_HOST='ä¸»æ•°æ®åº“åœ°å€',\nMASTER_USER='',\nMASTER_PASSWORD='',\nMASTER_PORT=3306,\n------åœ¨ä¸»æ•°æ®åº“å¾—åˆ°----------------\nMASTER_LOG_FILE='mysql-bin.000011',\nMASTER_LOG_POS=107,\n-----------------------------------\nMASTER_CONNECT_RETRY=10;\nå¯åŠ¨\nstart slave\nåœæ­¢\nstop slave\né‡ç½®\nreset slave all\n####é”™è¯¯æ’æŸ¥\nshow slave status\n1. å‡ºç°Error 'Can't create database 'testâ€˜; database exists'é”™è¯¯\nstop slave ;\nset GLOBAL sql_slave_skip_counter=1;\nstart slave;\n````\n#### æ³¨æ„æƒ…å†µ\n- è¦ç¡®ä¿ä¸»æ•°æ®åº“3306ç«¯å£å…è®¸å¤–éƒ¨è®¿é—®ï¼Œé˜¿é‡ŒæœåŠ¡å™¨éœ€è¦åœ¨å®‰å…¨ç­–ç•¥æ·»åŠ 3306ç«¯å£\n- å®‰è£…å®å¡”é¢æ¿ï¼Œä¹Ÿè¦åœ¨å®‰å…¨é‡Œæ·»åŠ 3306ç«¯å£\n- å¦‚æœä½¿ç”¨rdsæœåŠ¡å™¨ï¼Œæƒ³æŠŠrdsæ•°æ®åŒæ­¥åˆ°è‡ªå·±æ•°æ®åº“ï¼Œç›´æ¥æŠŠè‡ªå·±æ•°æ®åº“é…ç½®ä¸ºä»æ•°æ®åº“å³å¯\n- åˆ«å¿˜äº†rdsæ·»åŠ ipç™½åå•\n#### æ•°æ®æ˜ å°„\n> è·¨åº“è¡¨å…³è”è§£å†³æ–¹æ³•\n> ä¸šåŠ¡åœºæ™¯ï¼šå…³è”ä¸åŒæ•°æ®åº“ä¸­çš„è¡¨çš„æŸ¥è¯¢æ¯”å¦‚è¯´ï¼Œè¦å…³è”çš„è¡¨æ˜¯ï¼šæœºå™¨Aä¸Šçš„æ•°æ®åº“Aä¸­çš„è¡¨A && æœºå™¨Bä¸Šçš„æ•°æ®åº“Bä¸­çš„è¡¨Bã€‚\n````\né‡‡ç”¨çš„æ˜¯åŸºäºmysqlçš„federatedå¼•æ“çš„å»ºè¡¨æ–¹å¼\nå»ºè¡¨è¯­å¥ç¤ºä¾‹ï¼šCREATE TABLE `table_name`(......) ENGINE =FEDERATED CONNECTION='mysql://[username]:[password]@[location]:[port]/[db-name]/[table-name]'\nå‰ææ¡ä»¶ï¼šä½ çš„mysqlå¾—æ”¯æŒfederatedå¼•æ“ï¼ˆæ‰§è¡Œshow engines;å¯ä»¥çœ‹åˆ°æ˜¯å¦æ”¯æŒï¼‰ã€‚\n````\n#### å…³äºå¼€å¯GTIDä¸»ä»å¤åˆ¶ é”™è¯¯æ’æŸ¥\n\n> SHOW SLAVE STATUS; æŸ¥çœ‹GTIDé”™è¯¯æ—¶çš„ç¼–å·\n\n- mysql> Â STOP SLAVE;\n- mysql> RESET MASTER;\n- mysql> Â SET @@GLOBAL.GTID_PURGED ='d09c4417-7238-11e9-816b-ec0d9a7173e0:1-3231547'\n- mysql> Â START SLAVE;\n- mysql> Â SHOW SLAVE STATUS;\n","tags":["Php","Mysql"],"categories":["éšç¬”"]},{"title":"windowsåœ¨PowerShellä½¿ç”¨curlçš„ä¸åŒ","url":"/tech-notes/cmd-1561450865.html","content":"````\ncURL -XGET 'localhost:9200/library/book/_search'\n\nwindows é‡Œä¸‹é¢è¿™æ ·å†™\ncurl -Uri http://localhost:9200/library/book/_search -Method GET\n\nå¦‚æœä½¿httpsè¯·æ±‚ å¯èƒ½ä¼šæŠ¥ä¸‹é¢è¿™æ ·çš„é”™è¯¯ï¼š\n    curl : è¯·æ±‚è¢«ä¸­æ­¢: æœªèƒ½åˆ›å»º SSL/TLS å®‰å…¨é€šé“ã€‚\n    æ‰€åœ¨ä½ç½® è¡Œ:1 å­—ç¬¦: 1\n    + curl -Uri https://\nè§£å†³åŠæ³•ï¼š\nåœ¨è¯·æ±‚ä¹‹å‰åŠ è¿™æ ·ä¸€æ¡å‘½ä»¤ï¼š[System.Net.ServicePointManager]::SecurityProtocol=[System.Net.SecurityProtocolType]::Tls12\næˆ‘ä¹Ÿä¸çŸ¥é“å•¥æ„æ€ï¼Œåæ­£ä¸æŠ¥é”™äº†ï¼ï¼ï¼\ncurl -Uri https://\n````\n#### åƒPowerShellä¸æ”¯æŒçš„ç¬¦å·[&&]ï¼Œå‘ç°åœ¨cmdé‡Œè¿è¡Œæ˜¯æ­£å¸¸çš„ï¼ï¼ï¼\n> æŸ¥åŠå¤©èµ„æ–™ï¼ŒåŸæ¥åªè¦ç”¨cmdæ‰§è¡Œå°±å¯ä»¥äº†ï¼Œä¸€ç›´ä»¥ä¸ºPowerShellå’Œcmdå‘½ä»¤å·¥å…·æ˜¯ä¸€ä¸ªä¸œè¥¿ï¼ŒåŸæ¥ä¸ä¸€æ ·ã€‚ã€‚ã€‚","tags":["Linux"],"categories":["éšç¬”"]},{"title":"ç”³è¯·Httpsè¯ä¹¦","url":"/tech-notes/https-1559802916.html","content":"#### é€šè¿‡acme.shæ–¹å¼è·å–è¯ä¹¦çš„æ–¹æ³•\n> centos 7 ä¸‹æ“ä½œ\n\n````\n# å®‰è£… acme.sh\ncurl https://get.acme.sh | sh\nsource ~/.bashrc\n# æ›¿æ¢æˆä»é˜¿é‡Œäº‘åå°è·å–çš„å¯†é’¥\nexport Ali_Key=\"\"\nexport Ali_Secret=\"\"\n# æ¢æˆè‡ªå·±çš„åŸŸå\nacme.sh --issue --dns dns_ali -d lnews.top -d *.lnews.top\n# æˆåŠŸåç¨‹åºä¼šé€šè¿‡å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ›´æ–°è¯ä¹¦\n# å¼€å¯acme.shè‡ªåŠ¨æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬\nacme.sh  --upgrade  --auto-upgrade\n# å…³é—­è‡ªåŠ¨æ›´æ–°\nacme.sh --upgrade  --auto-upgrade  0\n````\n","tags":["Linux"],"categories":["éšç¬”"]},{"title":"Phpè·å–å­£åº¦ç¬¬ä¸€å¤©å’Œæœ€åä¸€å¤©","url":"/tech-notes/php-1558072759.html","content":"````\n#è¿”å›æœ¬å­£åº¦\nfunction  quarter_query($time){\n    $month = date('m',$time);\n    $quarter = floor(($month+2)/3);\n    return $quarter;\n}\n#è¿”å›æœ¬å­£åº¦ç¬¬ä¸€å¤©\nfunction datetime_query_start($quarter,$date=false){\n    $start = mktime(0,0,0,($quarter - 1) *3 +1,1,date('Y'));\n    if($date){\n        return date('Ymd',$start);\n    }\n    return $start;\n}\n#è¿”å›æœ¬å­£åº¦æœ€åä¸€å¤©\nfunction datetime_query_end($quarter,$date=false){\n    $end = mktime(0,0,0,$quarter * 3,date('t',mktime(0, 0 , 0,$quarter*3,1,date(\"Y\"))),date('Y'));\n    if($date){\n        return date('Ymd',$end);\n    }\n    return $end;\n}\n````\n","tags":["Php"],"categories":["éšç¬”"]},{"title":"å¼€å¯Mysqlæ…¢æ—¥å¿—","url":"/tech-notes/sql-1557369289.html","content":"#### å¼€å¯mysqlæ…¢æ—¥å¿—åŠŸèƒ½ï¼Œä¼˜åŒ–æ…¢æŸ¥è¯¢\n````\nwindows æ‰¾åˆ° my.ini æ–‡ä»¶\nlinux æ‰¾ my.cnf æ–‡ä»¶\næ·»åŠ \n[mysqld]\n;å¼€å¯æ…¢æ—¥å¿—\nslow_query_log = ON\n;æ…¢æ—¥å¿—å­˜æ”¾è·¯å¾„\nslow_query_log_file = \"d:/wamp/logs/sql_slow.log\"\n;è¶…è¿‡ 1s è®°å½•\nlong_query_time = 1\n````","tags":["Mysql"],"categories":["éšç¬”"]},{"title":"Phpå¤šçº¿ç¨‹è¯·æ±‚æ¥å£","url":"/tech-notes/php-1556436528.html","content":"````\n/**\n * @param $url\n * @param $dataArr\n * @return array\n */\nfunction curl_multi_post($url,$dataArr){\n    $mh = curl_multi_init();\n    foreach($dataArr as $arr){\n        $ch = curl_init();\n        curl_setopt($ch, CURLOPT_URL, $url);\n        curl_setopt($ch,CURLOPT_POST,1);\n        curl_setopt($ch, CURLOPT_POSTFIELDS, $arr);\n        curl_multi_add_handle($mh,$ch);\n    }\n    $active = null;\n    $result = [];\n    do {\n        while (($mrc = curl_multi_exec($mh, $active)) == CURLM_CALL_MULTI_PERFORM) ;\n        if ($mrc != CURLM_OK) { break; }\n        while ($done = curl_multi_info_read($mh)) {\n            $info = curl_getinfo($done['handle']);\n            $error = curl_error($done['handle']);\n            $result[] = curl_multi_getcontent($done['handle']);\n            curl_multi_remove_handle($mh, $done['handle']);\n            curl_close($done['handle']);\n        }\n        if ($active > 0) {\n            curl_multi_select($mh);\n        }\n\n    } while ($active);\n    curl_multi_close($mh);\n    return $result;\n}\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"Phpæ ¹æ®æŸä¸ªé”®å¯¹äºŒç»´æ•°ç»„æ’åº","url":"/tech-notes/php-1556098240.html","content":"#### å°è£…äº†æ–¹æ³•\n````\n/**\n * @param $arr\n * @param null $field  è¦æ’åºçš„é”®\n * @param null $length è·å–å‰å¤šå°‘æ¡è®°å½•\n * @param $order  SORT_DESC|SORT_ASC\n * @return array|null\n */\nfunction sort_field_arr($arr,$field=null,$length=null,$order){\n    if(empty($field)){\n        return null;\n    }\n    //è·å–è¦æ’åºçš„ä¸€ç»´æ•°ç»„\n    $arr1 = array_column($arr,$field);\n    //æ’åº\n    array_multisort($arr1,$order,$arr);\n    //è¿”å›é•¿åº¦\n    $arr2 = array_slice($arr,0,$length);\n    return $arr2;\n}\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"PHPè·å–ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶","url":"/tech-notes/php-1555655333.html","content":"\n````\n# ç›®å½•åœ°å€\n$dir = \"\";\n$fname = [];\n$dir = iconv(\"utf-8\", \"gb2312\", $dir);\n if ($headle = opendir($dir)) {\n        while ($file = readdir($headle)) {\n            $file = iconv(\"gb2312\", \"utf-8\", $file);\n            $fname[] = $file;\n        }\n    }\n # è¯»å–æ–‡ä»¶å†…å®¹\n foreach($fname as $fn){\n    # file æŠŠæ–‡ä»¶å†…å®¹è¯»å–åˆ°æ•°ç»„\n    $data = file($dir.$fn);\n    // to do  \n }\n````\n","tags":["Php"],"categories":["éšç¬”"]},{"title":"Phpå†…å­˜æº¢å‡ºçˆ¬å‘","url":"/tech-notes/php-1554363041.html","content":"#### å†…å­˜æº¢å‡ºæ€•å‘\n\n> ç‰¹ç‚¹è®°å½•å¦‚ä¸‹\n+ æŸ¥è¯¢sqlæ•°æ®æ—¶æœ‰æ—¶æ— \n+ æŠŠsqlç²˜åˆ°sqlå·¥å…·é‡Œæ•°æ®æ­£å¸¸\n+ ç©ºç™½é¡µé¢æœ‰æ—¶åˆ·æ–°ä¸‹ï¼Œä¼šé‡æ–°å‡ºç°æ•°æ®\n\n> è§£å†³æ–¹æ³•\n+ å¢åŠ ä¸´æ—¶å†…å­˜`ini_set( 'memory_limit', '1000M' );`\n+ å¢åŠ è¶…æ—¶æ—¶é—´`ini_set(\"max_execution_time\", \"3600\");`\n\n#### æ£€æŸ¥äº†ä¸€ä¸Šåˆsqlè¯­å¥ï¼ŒåŸæ¥æ—¶è¿™ä¸ªåŸå› ï¼Œé ï¼","tags":["Php","Mysql"],"categories":["éšç¬”"]},{"title":"Phpåˆå¹¶é”®å€¼ç›¸åŒçš„2ä¸ªæ•°ç»„","url":"/tech-notes/php-1554272920.html","content":"#### æˆ‘çš„éœ€æ±‚æ˜¯æŠŠ2ä¸ªè¡¨çš„æ•°æ®ç»Ÿè®¡åï¼Œæ”¾åœ¨ä¸€ä¸ªæ–°çš„è¡¨é‡Œ\n> ç¬¬ä¸€ä¸ªæ•°ç»„\n````\n$arr1 = [\n    [\n        'mid'=>1,\n        'jh_num'=>32\n    ],[\n        'mid'=>2,\n        'jh_num'=>3\n    ],[\n        'mid'=>3,\n        'jh_num'=>5\n    ],[\n        'mid'=>4,\n        'jh_num'=>8\n    ],[\n        'mid'=>5,\n        'jh_num'=>13\n    ]\n]\n````\n> ç¬¬äºŒä¸ªæ•°ç»„\n````\n$arr2 = [\n    [\n        'mid'=>2,\n        'dh_num'=>7\n    ],[\n        'mid'=>3,\n        'dh_num'=>23\n    ],[\n        'mid'=>4,\n        'dh_num'=>3\n    ],[\n        'mid'=>5,\n        'dh_num'=>1\n    ],[\n        'mid'=>6,\n        'dh_num'=>3\n    ],[\n        'mid'=>7,\n        'dh_num'=>34\n    ]\n]\n````\n> æ“ä½œ\n````\n//æå–mid\n$key1 = array_column($arr1,'mid');\n//ç”¨midä½œé”®\n$arr1 = array_combine($key1,$arr1);\n//åŒä¸Š\n$key2 = array_column($arr2,'mid');\n$arr2 = array_combine($key2,$arr2);\n\n//åˆå¹¶æå–çš„é”®\n$keys = array_keys(array_flip($key1)+array_flip($key2));\n$arr = []\n//éå†\nforeach ($keys as $key){\n        //æ²¡æœ‰å€¼èµ‹ç©ºæ•°ç»„ï¼ˆä¸ºäº†ç»Ÿä¸€æ·»åŠ ç©ºé”®ï¼Œå¯ä»¥ä¸ç”¨ï¼‰\n        if(empty($arr1[$key])){\n            $arr1[$key] = [\n                'jh_num' => ''\n            ];\n        }\n        if(empty($arr2[$key])){\n            $arr2[$key] = [\n                'dh_num' => ''\n            ];\n        }\n        $arr[] = array_merge($arr1[$key],$arr2[$key]);\n    }\nvar_dump($arr);\n\n//ç»“æœ\narray (size=6)\n  0 => \n    array (size=3)\n      'mid' => string '1' (length=1)\n      'jh_num' => string '32' (length=2)\n      'dh_num' => string '' (length=0)\n  1 => \n    array (size=3)\n      'mid' => string '2' (length=1)\n      'jh_num' => string '3' (length=1)\n      'dh_num' => string '7' (length=1)\n  2 => \n    array (size=3)\n      'mid' => string '3' (length=1)\n      'jh_num' => string '5' (length=1)\n      'dh_num' => string '23' (length=2)\n  3 => \n    array (size=3)\n      'mid' => string '4' (length=1)\n      'jh_num' => string '8' (length=1)\n      'dh_num' => string '3' (length=1)\n  4 => \n    array (size=3)\n      'mid' => string '5' (length=1)\n      'jh_num' => string '13' (length=2)\n      'dh_num' => string '1' (length=1)\n  5 => \n    array (size=3)\n      'mid' => string '6' (length=1)\n      'jh_num' => string '' (length=0)\n      'dh_num' => string '3' (length=1)\n  5 => \n    array (size=3)\n      'mid' => string '7' (length=1)\n      'jh_num' => string '' (length=0)\n      'dh_num' => string '34' (length=2)\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"å¾®ä¿¡å°ç¨‹åºä¹‹éŸ³ä¹æ’­æ”¾","url":"/tech-notes/wxmusic-1553936743.html","content":"####  å›¾ç‰‡çš„å°ç¨‹åºä¸ºæœ€ç»ˆæ•ˆæœ\n> ![image_text](/img/2019/wx_xcx.jpg)\n> éŸ³ä¹apiæ¥å£ `https://api.i-meto.com/meting/api?server=éŸ³ä¹å¹³å°&type=æ¨¡å¼&id=æ­Œæ›²idæˆ–æ­Œå•id` \n> ç½‘ä¸Šè¿˜æœ‰å¾ˆå¤šæ¥å£ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒï¼Œéå¸¸æ„Ÿè°¢ã€è¨æ‘©çš„APIç«™ã€‘æä¾›äº†æ¥å£\n\n> //music.js\n````\nconst backgroundAudioManager = wx.getBackgroundAudioManager()\nPage({\n\n  /**\n   * é¡µé¢çš„åˆå§‹æ•°æ®\n   */\n  data: {\n    isPlaying: false,\n    currentIndex: 0,\n    currentLry: 0,\n    marginTop: 0,\n    datalist: [],\n    progress: 0,\n    currentPosition: '00:00',\n    duration: '00:00',\n    song:'',\n    lry:''\n  },\n  /**\n   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åŠ è½½\n   */\n  onLoad: function (options) {\n    let that = this\n    let currentIndex = options.currentIndex||0\n    wx.request({\n      url: 'ä½ çš„åœ°å€',\n      success: (res)=>{\n        console.log(res)\n        that.setData({\n          datalist: res.data,\n        })\n        that.onInit(currentIndex)\n      }\n    })\n  },\n\n  /**\n   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢åˆæ¬¡æ¸²æŸ“å®Œæˆ\n   */\n  onReady: function () {\n\n  },\n\n  /**\n   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢æ˜¾ç¤º\n   */\n  onShow: function () {\n\n  },\n\n  /**\n   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢éšè—\n   */\n  onHide: function () {\n\n  },\n\n  /**\n   * ç”Ÿå‘½å‘¨æœŸå‡½æ•°--ç›‘å¬é¡µé¢å¸è½½\n   */\n  onUnload: function () {\n\n  },\n\n  /**\n   * é¡µé¢ç›¸å…³äº‹ä»¶å¤„ç†å‡½æ•°--ç›‘å¬ç”¨æˆ·ä¸‹æ‹‰åŠ¨ä½œ\n   */\n  onPullDownRefresh: function () {\n\n  },\n\n  /**\n   * é¡µé¢ä¸Šæ‹‰è§¦åº•äº‹ä»¶çš„å¤„ç†å‡½æ•°\n   */\n  onReachBottom: function () {\n\n  },\n\n  /**\n   * ç”¨æˆ·ç‚¹å‡»å³ä¸Šè§’åˆ†äº«\n   */\n  onShareAppMessage: function () {\n    return {\n      title: this.data.song.name,\n      path: '/pages/music/music?currentIndex='+this.data.currentIndex,\n      imageUrl: this.data.song.cover,\n    }\n  },\n  parseLyric: function (lrc_s) {\n    if (lrc_s) {\n      lrc_s = lrc_s.replace(/([^\\]^\\n])\\[/g, (match, p1) => p1 + '\\n[');\n      const lyric = lrc_s.split('\\n');\n      let lrc = [];\n      const lyricLen = lyric.length;\n      for (let i = 0; i < lyricLen; i++) {\n        // match lrc time\n        const lrcTimes = lyric[i].match(/\\[(\\d{2}):(\\d{2})(\\.(\\d{2,3}))?]/g);\n        // match lrc text\n        const lrcText = lyric[i].replace(/.*\\[(\\d{2}):(\\d{2})(\\.(\\d{2,3}))?]/g, '').replace(/<(\\d{2}):(\\d{2})(\\.(\\d{2,3}))?>/g, '').replace(/^\\s+|\\s+$/g, '');\n\n        if (lrcTimes) {\n          // handle multiple time tag\n          const timeLen = lrcTimes.length;\n          for (let j = 0; j < timeLen; j++) {\n            const oneTime = /\\[(\\d{2}):(\\d{2})(\\.(\\d{2,3}))?]/.exec(lrcTimes[j]);\n            const min2sec = oneTime[1] * 60;\n            const sec2sec = parseInt(oneTime[2]);\n            const msec2sec = oneTime[4] ? parseInt(oneTime[4]) / ((oneTime[4] + '').length === 2 ? 100 : 1000) : 0;\n            const lrcTime = min2sec + sec2sec + msec2sec;\n            lrc.push([lrcTime, lrcText]);\n          }\n        }\n      }\n      // sort by time\n      lrc = lrc.filter((item) => item[1]);\n      lrc.sort((a, b) => a[0] - b[0]);\n      return lrc;\n    }\n    else {\n      return [];\n    }\n  },\n  sliceNull: function (lrc) {\n    var result = []\n    for (var i = 0; i < lrc.length; i++) {\n      if (lrc[i][1] == \"\") {\n      } else {\n        result.push(lrc[i]);\n      }\n    }\n    return result\n  },\n  timeToString: function (duration) {\n    let str = '';\n    let minute = parseInt(duration / 60) < 10 ? ('0' + parseInt(duration / 60)) : (parseInt(duration / 60));\n    let second = duration % 60 < 10 ? ('0' + duration % 60) : (duration % 60);\n    str = minute + ':' + second;\n    return str;\n  },\n  onInit: function(index){\n    let that = this\n    //è®¾ç½®å½“å‰æ’­æ”¾\n    let song = this.data.datalist[index]\n    //è·å–æ­Œè¯\n    wx.request({\n      url: song.lrc,\n      success: (res) => {\n        this.setData({\n          currentIndex: index,\n          song: song,\n          lry: that.sliceNull(that.parseLyric(res.data))\n        })\n        let lry = this.data.lry\n\n        backgroundAudioManager.src = this.data.song.url\n        backgroundAudioManager.title = this.data.song.name\n        backgroundAudioManager.singer = this.data.song.artist\n        backgroundAudioManager.coverImgUrl = this.data.song.cover\n        backgroundAudioManager.webUrl = '/pages/music/music?currentIndex='+this.data.currentIndex\n\n        backgroundAudioManager.onTimeUpdate(function () {\n          let currentTime = backgroundAudioManager.currentTime\n          let duration = backgroundAudioManager.duration\n          let index = that.data.currentLry\n          that.setData({\n            progress: currentTime / duration * 100,\n            currentPosition: that.timeToString(parseInt(currentTime)),\n            duration: that.timeToString(parseInt(duration))\n          })\n          if (index > lry.length - 1 || currentTime < lry[index][0] || (!lry[index + 1] || currentTime >= lry[index + 1][0])) {\n            for (let i = 0; i < lry.length; i++) {\n              if (currentTime >= lry[i][0] && (!lry[i + 1] || currentTime < lry[i + 1][0])) {\n                that.setData({\n                  currentLry: i,\n                  marginTop: i * 16\n                })\n              }\n            }\n          }\n          that.onEven()\n        });\n        that.onPlay()\n      }\n    })\n  },\n  selectSong: function(e){\n    let index = e.currentTarget.dataset.index\n    if(index==this.data.currentIndex) return;\n    this.onInit(index)\n    this.setData({\n      isPlaying: false\n    })\n  },\n  onPlay: function(){\n    backgroundAudioManager.play()\n    this.setData({\n      isPlaying: true\n    })\n  },\n  onPause: function(){\n    backgroundAudioManager.pause()\n    this.setData({\n      isPlaying: false\n    })\n  },\n  //ç›‘å¬æ’­æ”¾äº‹ä»¶\n  onEven: function(){\n    let that = this\n    backgroundAudioManager.onStop(function () {\n      that.setData({\n        isPlaying: false\n      })\n    })\n    backgroundAudioManager.onPlay(function () {\n      that.setData({\n        isPlaying: true\n      })\n    })\n    backgroundAudioManager.onPause(function () {\n      that.onPause()\n    })\n    backgroundAudioManager.onEnded(function () {\n      let length = that.data.datalist.length\n      let index = that.data.currentIndex + 1\n      if (index > length) {\n        backgroundAudioManager.stop()\n        this.setData({\n          isPlaying: false\n        })\n      } else {\n        that.onInit(index)\n      }\n    })\n    backgroundAudioManager.onNext(function(){\n      let length = that.data.datalist.length\n      let index = that.data.currentIndex + 1\n      if(index > length){\n        return\n      }else{\n        that.onInit(index)\n      }\n    })\n    backgroundAudioManager.onPrev(function () {\n      let index = that.data.currentIndex - 1\n      if (index < 0) {\n        return\n      } else {\n        that.onInit(index)\n      }\n    })\n  }\n})\n````\n\n> //music.wxml\n````\n<view class=\"aplayer aplayer-withlrc aplayer-withlist\">\n  <view class=\"aplayer-body\">\n    <view class=\"aplayer-pic\" style=\"background-image: url({{song.cover}});background-color: #ad7a86;\">\n      <view wx:if=\"{{!isPlaying}}\" class=\"aplayer-button aplayer-play\" bindtap='onPlay'>\n        <image src=\"/image/play.png\"></image>\n      </view>\n      <view wx:else class=\"aplayer-button aplayer-pause\" bindtap='onPause'>\n        <image src=\"/image/pause.png\"></image>\n      </view>\n    </view>\n    <view class=\"aplayer-info\">\n      <view class=\"aplayer-music\">\n        <text class=\"aplayer-title\">{{song.name}}</text>\n        <text class=\"aplayer-author\"> - {{song.artist}}</text>\n      </view>\n      <view class=\"aplayer-lrc\">\n        <scroll-view class=\"aplayer-lrc-contents\" scroll-y=\"true\" scroll-top=\"{{marginTop}}\">\n          <view wx:for=\"{{lry}}\" wx:key=\"index\" class=\"{{currentLry==index?'aplayer-lrc-current':''}}\">{{item[1]}}</view>\n        </scroll-view>\n      </view>\n      <view class=\"aplayer-controller\">\n        <view class=\"aplayer-bar-wrap\">\n          <progress  class=\"aplayer-bar\" stroke-width=\"2\" activeColor=\"#cdcdcd\" percent=\"{{progress}}\" />\n        </view>\n        <view class=\"aplayer-time\">\n          <view class=\"aplayer-time-inner\">\n            <text>{{currentPosition}}</text>\n            /\n            <text>{{duration}}</text>\n            <view class=\"aplayer-icon\" bindtap='onShareAppMessage'>â¤</view>\n          </view>       \n        </view>\n      </view>\n    </view>\n  </view>\n  <view class=\"aplayer-list\">\n    <view wx:for=\"{{datalist}}\" wx:key=\"index\" bindtap='selectSong' data-index='{{index}}'>\n      <text class=\"aplayer-list-cur\" style=\"background-color: #ad7a86;{{currentIndex==index?'display:block':'display:none'}}\"></text>\n      <text class=\"aplayer-list-index\">{{index+1}}</text>\n      <text class=\"aplayer-list-title\">{{item.name}}</text>\n      <text class=\"aplayer-list-author\">{{item.artist}}</text>\n    </view>\n  </view>\n</view>\n````\n\n> //music.wxss  å•Šå“ˆå“ˆå“ˆï¼Œè¿™é‡Œç›´æ¥æŠŠaplayerçš„æ ·å¼å¤åˆ¶è¿‡æ¥ï¼Œæ”¹äº†æ”¹\n> æˆ‘çš„æ ·å¼å†™çš„åƒåœ¾çš„ä¸è¡Œï¼Œæœ‰å†™çš„å¥½çš„ï¼Œå¸Œæœ›èƒ½æä¾›çš„ç²¾ç¾çš„æ¨¡æ¿ï¼ï¼ï¼\n````\n.aplayer {\n    background: #fff;\n    font-family: Arial,Helvetica,sans-serif;\n    margin: 5px;\n    box-shadow: 0 2px 2px 0 rgba(0,0,0,.07), 0 1px 5px 0 rgba(0,0,0,.1);\n    border-radius: 2px;\n    overflow: hidden;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    -ms-user-select: none;\n    user-select: none;\n    line-height: normal;\n    position: relative;\n}\n.aplayer .aplayer-body {\n    position: relative;\n}\n.aplayer.aplayer-withlrc .aplayer-pic {\n    height: 90px;\n    width: 90px;\n}\n.aplayer .aplayer-pic {\n    position: relative;\n    float: left;\n    height: 66px;\n    width: 66px;\n    background-size: cover;\n    background-position: 50%;\n    transition: all .3s ease;\n    cursor: pointer;\n}\n.aplayer .aplayer-pic .aplayer-play {\n    width: 26px;\n    height: 26px;\n    border: 2px solid #fff;\n    bottom: 50%;\n    right: 50%;\n    margin: 0 -15px -15px 0;\n}\n.aplayer .aplayer-pic .aplayer-pause {\n    width: 16px;\n    height: 16px;\n    border: 2px solid #fff;\n    bottom: 4px;\n    right: 4px;\n}\n.aplayer .aplayer-pic .aplayer-play image{\n    position: absolute;\n    top: 3px;\n    left: 5px;\n    height: 20px;\n    width: 20px;\n}\n.aplayer .aplayer-pic .aplayer-pause image{\n    position: absolute;\n    top: 2px;\n    left: 2px;\n    height: 12px;\n    width: 12px;\n}\n.aplayer .aplayer-pic .aplayer-button {\n    position: absolute;\n    border-radius: 50%;\n    opacity: .8;\n    text-shadow: 0 1px 1px rgba(0,0,0,.2);\n    box-shadow: 0 1px 1px rgba(0,0,0,.2);\n    background: rgba(0,0,0,.2);\n    transition: all .1s ease;\n}\n.aplayer .aplayer-info {\n    margin-left: 66px;\n    padding: 14px 7px 0 10px;\n    height: 66px;\n    box-sizing: border-box;\n}\n.aplayer.aplayer-withlrc .aplayer-info {\n    margin-left: 90px;\n    height: 90px;\n    padding: 10px 7px 0;\n}\n.aplayer.aplayer-withlist .aplayer-info {\n    border-bottom: 1px solid #e9e9e9;\n}\n.aplayer .aplayer-info .aplayer-music {\n    overflow: hidden;\n    white-space: nowrap;\n    text-overflow: ellipsis;\n    margin: 0 0 13px 5px;\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    -ms-user-select: text;\n    user-select: text;\n    cursor: default;\n    padding-bottom: 2px;\n    height: 20px;\n}\n.aplayer .aplayer-info .aplayer-music .aplayer-title {\n    font-size: 14px;\n}\n.aplayer .aplayer-info .aplayer-music .aplayer-author {\n    font-size: 12px;\n    color: #666;\n}\n.aplayer .aplayer-lrc {\n    display: none;\n    position: relative;\n    height: 30px;\n    text-align: center;\n    overflow: hidden;\n    margin: -10px 0 7px;\n}\n\n.aplayer.aplayer-withlrc .aplayer-lrc {\n    display: block;\n}\n.aplayer .aplayer-lrc:before {\n    top: 0;\n    height: 10%;\n    background: linear-gradient(180deg,#fff 0,hsla(0,0%,100%,0));\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#ffffff\", endColorstr=\"#00ffffff\", GradientType=0);\n}\n.aplayer .aplayer-lrc:after {\n    bottom: 0;\n    height: 33%;\n    background: linear-gradient(180deg,hsla(0,0%,100%,0) 0,hsla(0,0%,100%,.8));\n    filter: progid:DXImageTransform.Microsoft.gradient(startColorstr=\"#00ffffff\", endColorstr=\"#ccffffff\", GradientType=0);\n}\n.aplayer .aplayer-lrc:after, .aplayer .aplayer-lrc:before {\n    position: absolute;\n    z-index: 1;\n    display: block;\n    overflow: hidden;\n    width: 100%;\n    content: \" \";\n}\n.aplayer .aplayer-lrc .aplayer-lrc-contents {\n    width: 100%;\n    transition: all .5s ease-out;\n    -webkit-user-select: text;\n    -moz-user-select: text;\n    -ms-user-select: text;\n    user-select: text;\n    cursor: default;\n    height: 32px\n}\n.aplayer .aplayer-lrc view.aplayer-lrc-current {\n    opacity: 1;\n    overflow: visible;\n    height: auto!important;\n    min-height: 16px;\n}\n.aplayer .aplayer-lrc view {\n    font-size: 12px;\n    color: #666;\n    line-height: 16px!important;\n    height: 16px!important;\n    padding: 0!important;\n    margin: 0!important;\n    transition: all .5s ease-out;\n    opacity: .4;\n    overflow: hidden;\n}\n.aplayer .aplayer-info .aplayer-controller {\n    position: relative;\n    display: flex;\n}\n.aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap {\n    margin: 0 0 0 5px;\n    padding: 4px 0;\n    cursor: pointer!important;\n    flex: 1;\n}\n.aplayer .aplayer-info .aplayer-controller .aplayer-bar-wrap .aplayer-bar {\n    position: relative;\n    height: 2px;\n    width: 100%;\n    background: #cdcdcd;\n}\n.aplayer .aplayer-info .aplayer-controller .aplayer-time {\n    position: relative;\n    right: 0;\n    bottom: 4px;\n    height: 17px;\n    color: #999;\n    font-size: 11px;\n    padding-left: 7px;\n}\n.aplayer .aplayer-info .aplayer-controller .aplayer-time .aplayer-time-inner {\n    vertical-align: middle;\n}\n.aplayer .aplayer-info .aplayer-controller .aplayer-volume-wrap {\n    position: relative;\n    display: inline-block;\n    margin-left: 3px;\n    cursor: pointer!important;\n}\n.aplayer .aplayer-list {\n    transition: all .5s ease;\n    will-change: height;\n    overflow: hidden;\n}\n.aplayer .aplayer-list view:first-child {\n    border-top: none;\n}\n.aplayer .aplayer-list view {\n    position: relative;\n    height: 32px;\n    line-height: 32px;\n    padding: 0 15px;\n    font-size: 12px;\n    border-top: 1px solid #e9e9e9;\n    cursor: pointer;\n    transition: all .2s ease;\n    overflow: hidden;\n    margin: 0;\n}\n.aplayer .aplayer-list view .aplayer-list-cur {\n    display: none;\n    width: 3px;\n    height: 22px;\n    position: absolute;\n    left: 0;\n    top: 5px;\n    cursor: pointer;\n}\n.aplayer .aplayer-list view .aplayer-list-index {\n    color: #666;\n    margin-right: 12px;\n    cursor: pointer;\n}\n.aplayer .aplayer-list view .aplayer-list-author {\n    color: #666;\n    float: right;\n    cursor: pointer;\n}\n.aplayer .aplayer-icon {\n    width: 15px;\n    height: 15px;\n    border: none;\n    background-color: transparent;\n    outline: 0;\n    cursor: pointer;\n    opacity: .8;\n    vertical-align: middle;\n    padding: 0;\n    font-size: 12px;\n    margin: 0;\n    display: inline-block;\n    line-height: 15px;\n    text-align: center;\n    box-shadow: 0 2px 2px 0 rgba(0,0,0,.07), 0 1px 5px 0 rgba(0,0,0,.1);\n    color: red\n}\n````\n> è¿˜æœ‰åˆ†äº«åˆ°æœ‹å‹åœˆæ²¡æœ‰åšï¼Œæ‡’å¾—ç ”ç©¶äº†ï¼Œæœ‰ä»£ç çš„å°ä¼™ä¼´ï¼Œæä¾›ä¸€ä»½å§ï¼ï¼ï¼æ„Ÿè°¢ï¼","tags":["éŸ³ä¹"],"categories":["éšç¬”"]},{"title":"æŸ¥çœ‹2ä¸ªè¡¨ä¸åŒçš„è®°å½•","url":"/tech-notes/sql-1553653512.html","content":"#### æŸ¥è¯¢2ä¸ªæ—¥å¿—è¡¨ä¸åŒçš„è®°å½•\n````\nSELECT * FROM \n(SELECT f_mid,f_keyid,f_php_self,f_php_act,f_query_string,f_fromzd,f_ip,f_date,f_ctime FROM member_fangwen_log \nUNION ALL \nSELECT f_mid,f_keyid,f_php_self,f_php_act,f_query_string,f_fromzd,f_ip,f_date,f_ctime FROM member_fangwen_log_201903) tb1 \nGROUP BY f_mid,f_keyid,f_php_self,f_php_act,f_query_string,f_fromzd,f_ip,f_date,f_ctime HAVING count(*) = 1\n````\n> åˆå¹¶èµ·æ¥åªæœ‰ä¸€æ¡çš„è®°å½•ï¼Œå½“ç„¶æ˜¯ä¸ç›¸åŒçš„ï¼Œå¦‚æœè¦ç›¸åŒè®°å½•åé¢ `count(*)>1`","tags":["Mysql"],"categories":["éšç¬”"]},{"title":"çº¯éŸ³ä¹","url":"/tech-notes/music-1553069533.html","content":"### é«˜æ¸…æ— æŸéŸ³ä¹ï¼Œè¯·å‰å¾€[è™¾ç±³éŸ³ä¹](https://www.xiami.com/)\n\n{% meting \"778066540\" \"xiami\" \"playlist\" \"mutex:true\" \"listmaxheight:340px\" \"preload:none\" \"theme:#ad7a86\" %}","tags":["éŸ³ä¹"],"categories":["éšç¬”"]},{"title":"é‡‡é›†è‚¡ç¥¨æ•°æ®ç¬¬äºŒç¯‡","url":"/caiji/caiji-1552983122.html","content":"#### ä¸‹é¢ä¸»è¦æ˜¯é’ˆå¯¹ã€è¯åˆ¸å®ã€‘æ¥å£çš„æ“ä½œ\n- [è¯åˆ¸å®](http://baostock.com)æ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºçš„è¯åˆ¸æ•°æ®å¹³å°ï¼ˆæ— éœ€æ³¨å†Œï¼‰ã€‚\n\n#### ç›®å½•ç»“æ„\n- application\n    - `__init__`.py\n    - init.py       `è·å–å†å²æ•°æ®æ–‡ä»¶`\n    - common.py     `å…¬å…±å‡½æ•°æ–‡ä»¶`\n    - index_pf.py   `å­£é¢‘ç›ˆåˆ©èƒ½åŠ›å®šæ—¶è„šæœ¬`\n    - index_op.py   `å­£é¢‘è¿è¥èƒ½åŠ›å®šæ—¶è„šæœ¬`\n    - Profit.py     `å­£é¢‘ç›ˆåˆ©èƒ½åŠ›æ¨¡å‹`\n    - Operation.py  `å­£é¢‘è¿è¥èƒ½åŠ›æ¨¡å‹`\n    - GpListInfo.py `è‚¡ç¥¨åˆ—è¡¨æ¨¡å‹`\n    \n#### GpListInfo.py\n````\n# coding:utf-8\nfrom sqlalchemy import Column, String,Integer, create_engine\n#from sqlalchemy.orm import sessionmaker\nfrom sqlalchemy.ext.declarative import declarative_base\n#from sqlalchemy import text\n\n# åˆ›å»ºå¯¹è±¡çš„åŸºç±»:\nBase = declarative_base()\n\nclass GpListInfo(Base):\n    __tablename__ = \"gp_list_info\"\n\n    id = Column(Integer, primary_key=True)\n    ts_code = Column(String(50))   \n    symbol = Column(String(50))        \n    name = Column(String(50))          \n    area = Column(String(50))         \n    industry = Column(String(50))     \n    fullname = Column(String(150))     \n    enname = Column(String(150))      \n    market = Column(String(50))        \n    exchange  = Column(String(50))     \n    curr_type  = Column(String(50))   \n    list_status  = Column(String(50)) \n    list_date  = Column(String(50))    \n    delist_date  = Column(String(50))  \n    is_hs  = Column(String(50))        \n\n    def __init__(self,cursor):\n        self.cursor = cursor\n\n    def get_list_info(self,sql):\n        return self.cursor.execute(sql).fetchall()\n    def set_list_info(self,sql):\n        return self.cursor.execute(sql)\n\n````\n#### Operation.py\n````\n# coding:utf-8\nfrom sqlalchemy import Column, String,Integer, create_engine\nfrom sqlalchemy.orm import sessionmaker\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import text\nimport time\n\nBase = declarative_base()\nclass Operation(Base):\n    __tablename__ = \"gp_operation\"\n    id = Column(Integer, primary_key=True)\n    code = Column(String(50))\n    pubDate = Column(String(50))\n    statDate = Column(String(50))\n    NRTurnRatio = Column(String(50))\n    NRTurnDays = Column(String(50))\n    INVTurnRatio = Column(String(50))\n    INVTurnDays = Column(String(50))\n    CATurnRatio = Column(String(50))\n    AssetTurnRatio = Column(String(50))\n    year = Column(Integer)\n    quarter = Column(Integer)\n    ctime = Column(Integer)\n\n    def __init__(self,cursor):\n        self.cursor = cursor\n    def get_operation(self,sql):\n        return self.cursor.execute(sql).fetchall()\n    def set_operation(self,sql):\n        return self.cursor.execute(sql)\n    def query_data(self,bs,code,year,quarter):\n        operation_list = []\n        rs_operation = bs.query_operation_data(code=code, year=year, quarter=quarter)\n        while (rs_operation.error_code == '0') & rs_operation.next():\n             operation_list = rs_operation.get_row_data()\n        if(operation_list):\n            rs_operation.fields.append('year')\n            rs_operation.fields.append('quarter')\n            rs_operation.fields.append('ctime')\n            operation_list.append(year)\n            operation_list.append(quarter)\n            operation_list.append(int(time.time()))\n            sql = \"insert into %s (%s) values %s\" %(self.__tablename__,','.join(rs_profit.fields),tuple(operation_list))\n            self.set_operation(sql)\n        else:\n            return\n\n````\n#### Profit.py\n````\n# coding:utf-8\nfrom sqlalchemy import Column, String,Integer, create_engine\nfrom sqlalchemy.orm import sessionmaker\nfrom sqlalchemy.ext.declarative import declarative_base\nfrom sqlalchemy import text\nimport time\n\nBase = declarative_base()\nclass Profit(Base):\n    __tablename__ = \"gp_profit\"\n    id = Column(Integer, primary_key=True)\n    code = Column(String(50))\n    pubDate = Column(String(50))\n    statDate = Column(String(50))\n    roeAvg = Column(String(50))\n    npMargin = Column(String(50))\n    gpMargin = Column(String(50))\n    netProfit = Column(String(50))\n    epsTTM = Column(String(50))\n    MBRevenue = Column(String(50))\n    totalShare = Column(String(50))\n    liqaShare = Column(String(50))\n    year = Column(Integer)\n    quarter = Column(Integer)\n    ctime = Column(Integer)\n\n    def __init__(self,cursor):\n        self.cursor = cursor\n    def get_profit(self,sql):\n        return self.cursor.execute(sql).fetchall()\n    def set_profit(self,sql):\n        return self.cursor.execute(sql)\n    def query_data(self,bs,code,year,quarter):\n        profit_list = []\n        rs_profit = bs.query_profit_data(code=code, year=year, quarter=quarter)\n        while (rs_profit.error_code == '0') & rs_profit.next():\n             profit_list = rs_profit.get_row_data()           \n        if(profit_list):\n            rs_profit.fields.append('year')\n            rs_profit.fields.append('quarter')\n            rs_profit.fields.append('ctime')\n            profit_list.append(year)\n            profit_list.append(quarter)\n            profit_list.append(int(time.time()))        \n            sql = \"insert into %s (%s) values %s\" %(self.__tablename__,','.join(rs_profit.fields),tuple(profit_list))\n            self.set_profit(sql)\n        else:\n            return\n\n````\n#### common.py\n````\n# coding:utf-8\nimport baostock as bs\nimport time\nfrom sqlalchemy import create_engine\n#from sqlalchemy.orm import sessionmaker\nfrom application.GpListInfo import  *\n\n\n\ndef get_query_by_date():\n    localtime = time.localtime(time.time())\n    year,month = localtime[:2]\n    quarter = (month+2)//3\n    if(quarter==1):\n        return [(year-1,3),(year-1,4)]\n    if(quarter==2):\n        return [(year-1,4),(year,1)]\n    if(quarter==3):\n        return [(year,1),(year,2)]\n    if(quarter==4):\n        return [(year,2),(year,3)]\n\n# æŸ¥è¯¢æœ‰æ²¡æœ‰æ•°æ®\ndef get_data(obj,code,year,quarter):\n    where = \" and code='%s' and year=%d and quarter=%d\" %(code,year,quarter)\n    res  = obj.cursor.execute(\"select * from %s where 1 %s\" %(obj.__tablename__,where))\n    if(res.rowcount==0):\n        #æ²¡æŸ¥åˆ°ï¼Œä»æ¥å£è·å–\n        # ç™»é™†ç³»ç»Ÿ\n        lg = bs.login()\n        obj.query_data(bs,code,year,quarter)\n        # ç™»å‡ºç³»ç»Ÿ\n        bs.logout()\n\n# æ•°æ®åº“å®ä¾‹\ndef db():\n    engine = create_engine('mysql+pymysql://root:@localhost:3306/gupiao?charset=utf8&autocommit=true',echo=True)\n    return engine\n\n# è·å–è‚¡ç¥¨åˆ—è¡¨\ndef get_list_info():\n    gp = GpListInfo(db())\n    gp_list = gp.get_list_info(\"select * from %s\" %gp.__tablename__)\n    return gp_list\n\n\n````\n#### init.py\n````\n# coding:utf-8\nimport application.common as common\n\nimport baostock as bs\n\nfrom application.Profit import *\nfrom application.Operation import *\nfrom application.Growth import *\n\ndef insert_data(obj,list):\n    for row in gp_list:\n        code = row['ts_code']\n        for i in range(0,len(year)):\n            for j in range(0,4):\n                bs.login()\n                obj.query_data(bs,code,year[i],quarter[j])\n                bs.logout()\n\nyear = [2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018]\nquarter = [1,2,3,4]\n\n# è‚¡ç¥¨åˆ—è¡¨\ngp_list = common.get_list_info()\n\n# å­£é¢‘ç›ˆåˆ©èƒ½åŠ›\npf = Profit(common.db())\n\n# å­£é¢‘è¥è¿èƒ½åŠ›\nop = Operation(common.db())\ninsert_data(op,gp_list)\n\n\n````\n#### index_pf.py\n````\n# coding:utf-8\n# å­£é¢‘ç›ˆåˆ©èƒ½åŠ›\nimport application.common as common\nfrom application.Profit import  *\n\n# è‚¡ç¥¨åˆ—è¡¨\ngp_list = common.get_list_info()\n\n# \npf = Profit(common.db())\n\nfor row in gp_list:\n    localtime = common.get_query_by_date()\n    for i in range(0,len(localtime)):\n        year = localtime[i][0]\n        quarter = localtime[i][1]\n\n        common.get_data(pf,row.ts_code,year,quarter)\n````\n#### index_op.py\n````\n# coding:utf-8\n# å­£é¢‘è¥è¿èƒ½åŠ›\nimport application.common as common\nfrom application.Operation import  *\n\n# è‚¡ç¥¨åˆ—è¡¨\ngp_list = common.get_list_info()\n\n# \nop = Operation(common.db())\n\nfor row in gp_list:\n    localtime = common.get_query_by_date()\n    for i in range(0,len(localtime)):\n        year = localtime[i][0]\n        quarter = localtime[i][1]\n\n        common.get_data(op,row.ts_code,year,quarter)\n````\n\n#### æ³¨æ„äº‹é¡¹\n> åƒè¿™æ ·çš„from application.Operation import  *ï¼ŒåŠ è½½ä¸è¿›å»ï¼Œå¯ä»¥æŠŠapplicationåˆ äº†\n> from Operation import  * è¿™æ ·åŠ è½½\n\n> è¿è¡Œ python3 init.py `[*]`","tags":["Python","é‡‡é›†"],"categories":["é‡‡é›†"]},{"title":"ä½¿ç”¨å®å¡”åå®‰è£…Python3","url":"/tech-notes/pthon3-1552533607.html","content":"#### åœ¨ä¸å½±å“å®å¡”é¢æ¿çš„æƒ…å†µä¸‹ï¼Œå®‰è£…python3.6\n+ pythonæ›´æ–°è¿­ä»£å¿«ï¼Œç°åœ¨ä¸»æµæ¨¡å—éƒ½æ˜¯pythonç‰ˆæœ¬3çš„ï¼Œä¸‹è½½èµ„æºåŒ…\n> wget https://www.python.org/ftp/python/3.6.3/Python-3.6.0.tgz\n+ è§£å‹\n> tar -zxvf Python-3.6.0.tgz\n+ è¿›å…¥å®‰è£…ç›®å½•\n> cd Python-3.6.0\n+ ç¼–è¯‘ï¼Œåé¢ä¸€å®šè¦åŠ ä¸Šå˜å¼‚ç›®å½•ï¼Œé˜²æ­¢è¦†ç›–å½±å“å®å¡”é¢æ¿æ­£å¸¸è¿è¡Œ\n> ./configure --prefix=/usr/local/python36\n> make && make install\n+ å»ºç«‹è½¯é“¾æ¥ï¼Œä¹Ÿå°±æ˜¯ç¯å¢ƒå˜é‡\n> ln -s  /usr/local/python36/bin/python3.6  /usr/bin/python3\n> ln -s  /usr/local/python36/bin/pip3.6  /usr/bin/pip3\n+ ç°åœ¨å°±å¯ä»¥ä½¿ç”¨python3å’Œpip3å‘½ä»¤äº†\n#### å¦‚æœä¸Šé¢è¾“å…¥æœ‰è¯¯ï¼Œå¯ä»¥è¦†ç›–ï¼Œçœ‹è‡ªå·±æƒ…å†µ\n> ln -snf  /usr/local/python36/bin/python3  /usr/bin/python3\n","tags":["Python"],"categories":["éšç¬”"]},{"title":"é‡‡é›†è‚¡ç¥¨æ•°æ®ç¬¬ä¸€ç¯‡","url":"/caiji/caiji-1552468822.html","content":"#### æˆ‘ä»¬åˆ©ç”¨2ä¸ªæä¾›æ•°æ®è·å–ç¤¾åŒºæ¥è¾¾åˆ°ç›®çš„\n- [Tushare](https://tushare.pro)é‡‘èå¤§æ•°æ®å¼€æ”¾ç¤¾åŒºï¼ˆéœ€è¦æ³¨å†Œï¼‰\n- [è¯åˆ¸å®](http://baostock.com)æ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºçš„è¯åˆ¸æ•°æ®å¹³å°ï¼ˆæ— éœ€æ³¨å†Œï¼‰ã€‚\n\n#### ä¸‹é¢ä¸Špythonä»£ç \n> å®‰è£…ä¸‹é¢æ¨¡å—åº”è¯¥ä¸å¿…å¤šè¯´\n> åˆ›å»ºæ•°æ®åº“gupiao\n> è¿è¡Œä¸‹é¢ä»£ç å°±ä¼šå¾—åˆ°gp_list_infoè¿™å¼ åŒ…å«æ‰€æœ‰è‚¡ç¥¨åŸºæœ¬ä¿¡æ¯çš„è¡¨ï¼ˆä½ ä¹Ÿå¯ä»¥å­˜æˆæ–‡ä»¶ï¼Œé‚£å°±ä¸ä¼šè¦pymysqlï¼Œsqlalchemyæ¨¡å—ï¼‰\n> æ³¨æ„äº‹é¡¹ï¼šå¦‚æœå®‰è£…tushareåï¼Œè¿è¡ŒæŠ¥é”™bs4ä»€ä¹ˆçš„ï¼Œä½ è¦å®‰è£…è¿™ä¸ªæ¨¡å—beautifulsoup4\n````\n#Tushareé‡‘èå¤§æ•°æ®å¼€æ”¾ç¤¾åŒº\nimport tushare as ts\n#æ“ä½œæ•°æ®åº“æ¨¡å—\nimport pymysql\nfrom sqlalchemy import create_engine\n\nts.set_token('ä½ çš„token')\npro = ts.pro_api()\n#æŸ¥è¯¢å½“å‰æ‰€æœ‰æ­£å¸¸ä¸Šå¸‚äº¤æ˜“çš„è‚¡ç¥¨åˆ—è¡¨\ndata = pro.stock_basic(exchange='', list_status='L', fields='ts_code,symbol,name,area,industry,fullname,enname,market,exchange,curr_type,list_status,list_date,delist_date,is_hs')\n\n#è¿æ¥æ•°æ®åº“\nengine = create_engine('mysql+pymysql://root:@localhost:3306/gupiao?charset=utf8')\n\n# æ’å…¥æ•°æ®\ndata.to_sql('gp_list_info',con=engine,if_exists='append',index=False)\n````\n> æ¥ä¸‹æ¥æˆ‘ä»¬è¯•ç€è·å–ä¸€ä¸‹baostockæä¾›çš„æ•°æ®ï¼ˆç”¨è¿™ä¸ªä¸»è¦æ˜¯æ²¡é™åˆ¶ï¼Œä½†æˆ‘æ²¡æ‰¾åˆ°è·å–æ‰€æœ‰è‚¡ç¥¨åˆ—è¡¨çš„æ¥å£ï¼Œæ‰€ä»¥ç”¨ä¸Šé¢é‚£ä¸ªè·å–ä¸€ä¸‹ï¼‰\n> è·å–ã€å­£é¢‘ç›ˆåˆ©èƒ½åŠ›ã€‘\n````\n#è¯åˆ¸å®www.baostock.comæ˜¯ä¸€ä¸ªå…è´¹ã€å¼€æºçš„è¯åˆ¸æ•°æ®å¹³å°ï¼ˆæ— éœ€æ³¨å†Œï¼‰ã€‚\nimport baostock as bs\nimport pandas as pd\nimport pymysql\nfrom sqlalchemy import create_engine\nimport time;\n\n# ç™»é™†ç³»ç»Ÿ\nlg = bs.login()\n\n#é“¾æ¥æ•°æ®åº“\nengine = create_engine('mysql+pymysql://root:@localhost:3306/gupiao')\n#è·å–è‚¡ç¥¨ä»£ç åˆ—è¡¨\nsql = ''' select ts_code from gp_list_info; '''\ndf = pd.read_sql_query(sql, engine)\n# æŸ¥è¯¢å­£é¢‘ä¼°å€¼æŒ‡æ ‡ç›ˆåˆ©èƒ½åŠ›\n\nyear = [2007,2008,2009,2010,2011,2012,2013,2014,2015,2016,2017,2018]\nquarter = [1,2,3,4]\nfor index,row in df.iterrows():\n    #è¿™é‡Œç”±äº2ä¸ªç¼–ç ä¸ä¸€è‡´ï¼Œè½¬æ¢ä¸€ä¸‹\n    code = row['ts_code'].split('.')\n    code = code[1]+'.'+code[0]\n    for i in range(0,len(year)):\n        for j in range(0,4):            \n            rs_profit = bs.query_profit_data(code=code, year=year[i], quarter=quarter[j])\n            profit_list = []\n            while (rs_profit.error_code == '0') & rs_profit.next():\n                rs_profit.fields.append('year')\n                rs_profit.fields.append('quarter')\n                rs_profit.fields.append('ctime')\n                row_data = rs_profit.get_row_data()\n                row_data.append(year[i])\n                row_data.append(quarter[j])\n                row_data.append(int(time.time()))\n                profit_list.append(row_data)\n                result_profit = pd.DataFrame(profit_list, columns=rs_profit.fields)\n                # æ’å…¥æ•°æ®\n                result_profit.to_sql('gp_profit',con=engine,if_exists='append',index=True)\n    print(index)\n# ç™»å‡ºç³»ç»Ÿ\nbs.logout()\n````\n> OKï¼Œè¿è¡Œå®Œåå°±å¯ä»¥å¾—åˆ°2007-2018æ‰€æœ‰å­£åº¦çš„ç›ˆåˆ©èƒ½åŠ›æ•°æ®äº†","tags":["Python","é‡‡é›†"],"categories":["é‡‡é›†"]},{"title":"TensorFlowåˆæ¢","url":"/tech-notes/tensorflow-1551755601.html","content":"#### å®‰è£…è™šæ‹Ÿç¯å¢ƒ virtualenv\n> pip install virtualenv\n\n#### åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ\n> virtualenv --system-site-packages -p python .\\Lzz\\TensorFlow\n\n#### æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ\n> cd .\\Lzz\\TensorFlow\\Scripts\n> activate\n\n#### å®‰è£… tensorflow\n> pip install tensorflow\n\n#### è¿™é‡Œå®‰è£…å¥½ä½¿ç”¨çš„æ—¶å€™å¦‚æœæç¤º**ImportError: DLL load failed: æ‰¾ä¸åˆ°æŒ‡å®šçš„æ¨¡å—ã€‚**\n> pip uninstall tensorflow æŠŠåŸæ¥æœ€æ–°ç‰ˆæœ¬å¸è½½ pip install tensorflow==1.9\n> pip uninstall protobuf å¸è½½  pip install protobuf==3.6.0\n> ##### æµ‹è¯•äº†ä¸€ä¼šï¼Œå‘ç°åªè¦ä¸‹é¢çš„æ˜¯3.6.0å°±å¯ä»¥ï¼Œä¸è¦ç®¡tensorflow 1.12.0 has requirement protobuf>=3.6.1, but you'll have protobuf 3.6.0 which is incompatible.è¿™ä¸ªæŠ¥é”™\n> pip install protobuf==3.6.0\n> è¿™é‡Œæäº†å¤§åŠå¤©ï¼Œå¤ªä»–å¦ˆå‘äº†ï¼ï¼ï¼\n\n#### é€€å‡ºè™šæ‹Ÿç¯å¢ƒ\n> deactivate\n\n#### èµ„æºé“¾æ¥\né“¾æ¥ï¼šhttps://pan.baidu.com/s/10BGo4NfxQJxGBaKPpcL52Q \næå–ç ï¼š5yuv ","tags":["Python"],"categories":["éšç¬”"]},{"title":"é‡‡é›†å¥½çœ‹çŸ­è§†é¢‘","url":"/tech-notes/caiji-1551347404.html","content":"åºŸè¯ä¸å¤šè¯´ï¼Œç ”ç©¶äº†å¤§åŠå¤©ï¼Œå®Œæˆçš„æ‰‹åŠ¨é‡‡é›†ï¼Œæœ‰è‡ªå·±æœåŠ¡å™¨çš„å°ä¼™ä¼´å¯ä»¥è‡ªåŠ¨è¿è¡Œè¯•è¯•\næœ¬åœ° ç›´æ¥ php haokan.php å°±å¯ä»¥äº†\n````\n<?php\n/**\n * Created by PhpStorm.\n * User: Lzz\n * Date: 2019/2/28\n * Time: 10:03\n */\nclass Haokan {\n    # é…ç½®\n    protected $option = [\n        'url' => 'https://sv.baidu.com/',\n        'header' => [\n            'referer: https://sv.baidu.com/',\n            'user-agent: Mozilla/5.0 (iPhone; CPU iPhone OS 10_3_1 like Mac OS X) AppleWebKit/603.1.30 (KHTML, like Gecko) Version/10.0 Mobile/14E304 Safari/602.1'\n        ],\n    ];\n    # dom\n    protected $xp;\n    # åˆ†ç±»\n    protected $fenlei=[];\n    # è·å–åˆ°çš„è§†é¢‘é“¾æ¥\n    protected $vsrc=[];\n\n    public function __construct($option=[])\n    {\n        $this->option = array_merge($this->option,$option);\n    }\n    # è·å–åˆ†ç±»\n    public function get_fenlei(){\n        $list = $this->c_dom($this->option['url'])->xp->query('//div[@class=\"video-tabs-wrapper\"]/ul/li/a');\n        for($i=0;$i<$list->length;$i++){\n            array_push($this->fenlei,[\n                'href' => $list->item($i)->getAttribute('href'),\n                'name' => $list->item($i)->textContent\n            ]);\n        }\n        return $this;\n    }\n    # è·å–åˆ†ç±»ä¸‹çš„çŸ­è§†é¢‘é“¾æ¥\n    public function get_active_sp(){\n        $this->get_fenlei();\n        $t = time();\n        $tt = (time()+1800).'000';\n        foreach ($this->fenlei as $k=>$f){\n            $href = str_replace('#','',$f['href']);\n            $url = \"https://sv.baidu.com/videoui/list/tab?source=wise-channel&pd=&subTab=$href&caller=bdwise\";\n            $list = $this->http_curl($url);\n            preg_match_all('/(?<=data-vsrc=).*?.mp4/',$list,$arr);\n            $this->vsrc[$k] = [\n                'href' => $f['href'],\n                'name' => $f['name'],\n                'list' => [\n\n                ]\n            ];\n            foreach ($arr[0] as $a){\n                if(strlen($a)>255){\n                    unset($a);\n                }\n                array_push($this->vsrc[$k]['list'],str_replace('\\\"','',$a));\n            }\n        }\n        return $this->vsrc;\n    }\n    # è¿™é‡Œä½ ä»¬ä¸éœ€è¦äº†\n    # åˆ›å»ºhexoæ–‡ç« \n    public function create_hexo(){\n        $this->get_active_sp();\n        $title = 'å¥½çœ‹çŸ­è§†é¢‘'.date('Ymd');\n        $date = date('Y-m-d H:i:s');\n        $md = <<<MDTITLE\ntitle: $title\nentitle: ''\nauthor: lzz\navatar: /images/favicon.ico\nauthorLink: 'https://lzz1.top'\nauthorAbout: 'https://lzz1.top'\nauthorDesc: \"å¦ä¸€ä¸ªæ¬\\U0001F9F1çš„åŠ³æ–¯åŸº\\U0001F601ï¸ï¸\"\ncategories: é‡‡é›†\ndate: $date\ntags:\n    - é‡‡é›†\nkeywords: é‡‡é›†\ndescription: å¥½çœ‹çŸ­è§†é¢‘é‡‡é›†\nphotos:\n---\n\nMDTITLE;\n        foreach ($this->vsrc as $v){\n            $md .= <<<MDCONTENT\n### {$v['name']}\\n\nMDCONTENT;\n            foreach ($v['list'] as $kk=>$vv){\n                if(!empty($vv)){\n                    $md .= <<<MDLIST\n> <video style=\"width:50%;max-height:240px\" controls><source src=\"$vv\" type=\"video/mp4\"/></video>\\n\nMDLIST;\n                }\n            }\n\n        }\n        file_put_contents('source/_posts/'.$title.'.md',$md);\n    }\n\n    # åˆ›å»ºDom\n    public function c_dom($url){\n        $dom = new DOMDocument('1.0','utf-8');\n        $html = $this->http_curl($url);\n        @$dom->loadHTML($html);\n        $dom->normalize();\n        $xp = new DOMXPath($dom);\n        $this->xp = $xp;\n        return $this;\n    }\n    #\n    public function http_curl($url){\n        $ch = curl_init();\n        curl_setopt($ch, CURLOPT_URL, $url);//è¦è®¿é—®çš„url\n        curl_setopt($ch,CURLOPT_RETURNTRANSFER,1);\n        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);//httpsç½‘ç«™å–æ¶ˆssléªŒè¯\n        curl_setopt($ch,CURLOPT_FOLLOWLOCATION,1);//å…è®¸30*è·³è½¬\n        curl_setopt($ch, CURLOPT_TIMEOUT,30);//è®¾ç½®è¶…æ—¶æ—¶é—´\n        curl_setopt($ch,CURLOPT_HTTPHEADER,$this->option['header']);\n        $response = curl_exec($ch);\n        if ($response === false) {\n            $error_info =  curl_error($ch);\n            echo $error_info;\n            curl_close($ch);//å…³é—­curl\n            return false;\n        } else {\n            //echo curl_getinfo($ch, CURLINFO_HEADER_OUT);\n            curl_close($ch);//å…³é—­curl\n            return $response;\n        }\n    }\n}\n$haokan = new Haokan();\n$haokan->create_hexo();\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"phpå›¾ç‰‡Imgickæ‰©å±•ç±»","url":"/tech-notes/php-1551257711.html","content":"````\nclass Imgick_tool{\n    //Imagickå¯¹è±¡å®ä¾‹\n    public $obj = null;\n    public function __construct()\n    {\n        //åˆ¤æ–­æ˜¯å¦åŠ è½½äº†è¯¥æ‰©å±•\n        if(!extension_loaded('Imagick'))\n        {\n            return false;\n        }\n        $this->obj = new Imagick();\n    }\n    /*\n\t * png2jpgè½¬æ¢å›¾ç‰‡æ ¼å¼\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n\t * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n\t */\n    public function png2jpg($src_img,$dest_img)\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $this->obj->readImage($src_img);\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * å»æ‰å›¾ç‰‡çš„profileä¿¡æ¯\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @return string src_img å›¾ç‰‡åç§° å¦åˆ™è¿”å›false\n\t */\n    public function strip_profile($src_img,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->stripImage ();\n            if($this->obj->writeImage ($dest_img))\n            {\n                $this->destory();\n                return $src_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n         * è®¾ç½®jpgå›¾ç‰‡è´¨é‡\n         *\n         * @param string src_img æºå›¾ç‰‡è·¯å¾„\n         * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n         * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n         */\n    public function set_quality($src_img,$quality = 70,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->setImageCompression(Imagick::COMPRESSION_JPEG);\n            $this->obj->setImageCompressionQuality($quality);\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n      * å›¾ç‰‡ç˜¦èº«\n      *\n      * @param string src_img æºå›¾ç‰‡è·¯å¾„\n      * @param int quality è®¾ç½®å›¾ç‰‡å‹ç¼©è´¨é‡\n      * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n      * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n      */\n    public function slimming($src_img,$quality = 60,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->setImageFormat('jpeg');\n            $this->obj->setImageCompression(Imagick::COMPRESSION_JPEG);\n            //å°†å›¾ç‰‡çš„è´¨é‡é™ä½åˆ°åŸæ¥çš„60%\n            $quality = $this->obj->getImageCompressionQuality() * $quality / 100;\n            $this->obj->setImageCompressionQuality($quality);\n            $this->obj->stripImage();\n\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * ç”Ÿæˆç¼©ç•¥å›¾\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @param int quality è®¾ç½®å›¾ç‰‡å‹ç¼©è´¨é‡\n\t * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n\t * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n\t */\n    public function thump($src_img,$width = 250,$height = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n\n            $file_info = pathinfo($src_img);\n            //ç”Ÿæˆç¼©ç•¥å›¾åç§°\n            $file_name = substr($file_info['basename'],0,strrpos($file_info['basename'],'.'));\n            $dest_img = $file_info['dirname'] . '/' . $file_name . '_thump.' . $file_info['extension'];\n            $this->obj->readImage($src_img);\n            //è®¡ç®—è¦è·å¾—ç¼©ç•¥å›¾çš„é«˜åº¦\n            $img_width = $this->obj->getImageWidth();\n            $img_height = $this->obj->getImageHeight();\n            $dest_height = $img_height * ($width / $img_width);\n            $this->obj->resizeImage($width, $dest_height, Imagick::FILTER_CATROM, 1, false);\n            //ç”Ÿæˆå›¾ç‰‡\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * é‡Šæ”¾èµ„æº\n\t *\n\t */\n    function destory()\n    {\n        if(is_object($this->obj))\n        {\n            $this->obj->clear();\n\n            $this->obj->destroy();\n        }\n    }\n}\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"Hexoä½¿ç”¨gitalkè¯„è®º","url":"/tech-notes/gitalk-1551239869.html","content":"ä»Šå¤©å‘ç°gitæä¾›äº†è¯„è®ºçš„apiï¼Œç«‹é©¬èˆå¼ƒåŸæ¥çš„valineğŸ˜‚ï¼Œæ¯•ç«Ÿè¿™ä¸ªç«™æ‰˜ç®¡åœ¨gitï¼Œå½“ç„¶è¦å…¨éƒ¨gitåŒ–ã€‚\n- ç”³è¯·githubåº”ç”¨ï¼Œç‚¹å‡»æˆ‘**[ä¼ é€é—¨](https://github.com/settings/applications/new)**\n- ç”³è¯·å¥½ä»¥åï¼Œåœ¨æ¨¡æ¿é‡Œå¼•å…¥ä¸‹é¢ä»£ç \n````\n<% if (theme.comments.enable && page.comments){ %>\n<section id=\"comments\">\n    <div id=\"gitalk-container\" style=\"margin: 30px;\"></div>\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/gitalk/dist/gitalk.css\">\n    <script src=\"https://unpkg.com/gitalk/dist/gitalk.min.js\"></script>\n    <script>\n        var gitalk = new Gitalk({\n            clientID: '<%= theme.comments.clientID %>',\n            clientSecret: '<%= theme.comments.clientSecret %>',\n            repo: '<%= theme.comments.repo %>',\n            owner: '<%= theme.comments.owner %>',\n            admin: ['<%= theme.comments.admin.join(',') %>'],\n            id: '<%= page.title %>',      // Ensure uniqueness and length less than 50\n            distractionFreeMode: false  // Facebook-like distraction free mode\n        })\n\n        gitalk.render('gitalk-container')\n    </script>\n</section>\n<% } %>\n````\n- ä¸»é¢˜é…ç½®\n````\ncomments:\n  enable: true\n  clientID: ä¸Šé¢ç”³è¯·çš„\n  clientSecret: ä¸Šé¢ç”³è¯·çš„\n  repo: lnew.github.io  ä»“åº“ï¼Œè¿™æ˜¯æˆ‘çš„ï¼Œæ·»ä½ è‡ªå·±çš„\n  owner: lnew æ‹¥æœ‰è€…\n  admin:\n    - lnew ç®¡ç†å‘˜\n````\n#### å¥½äº†ï¼Œè¿™å°±okäº†ï¼Œç”¨è‡ªå·±githubç™»å½•åˆå§‹åŒ–ä¸€ä¸‹è¯•è¯•å§","tags":["Hexo"],"categories":["éšç¬”"]},{"title":"è½¬åŒ–æ•°ç»„ä¸ºæ ‘å½¢ç»“æ„","url":"/tech-notes/tree-1551161827.html","content":"````\nfunction list_to_tree($list, $pk='id', $pid = 'pid', $child = 'children', $root = 0, $strict = false) {\n        // åˆ›å»ºTree\n        $tree = array();\n        if (is_array($list)) {\n            // åˆ›å»ºåŸºäºä¸»é”®çš„æ•°ç»„å¼•ç”¨\n            $refer = array();\n            foreach ($list as $key => $data) {\n                $refer[$data[$pk]] =& $list[$key];\n            }\n            foreach ($list as $key => $data) {\n                // åˆ¤æ–­æ˜¯å¦å­˜åœ¨parent\n                $parent_id = $data[$pid];\n                if ($parent_id === null || (int)$root === $parent_id) {\n                    $tree[] =& $list[$key];\n                } else {\n                    if(isset($refer[$parent_id])){\n                        $parent =& $refer[$parent_id];\n                        $parent[$child][] =& $list[$key];\n                    } else {\n                        if($strict === false){\n                            $tree[] =& $list[$key];\n                        }\n                    }\n                }\n            }\n        }\n        return $tree;\n    }\n````","tags":["Php"],"categories":["éšç¬”"]},{"title":"å¯¹å•†å“æœç´¢å…³é”®å­—ä¼˜åŒ–","url":"/tech-notes/-1551078946.html","content":"````\nå¦‚é‡åˆ°ï¼Œã€è”æƒ³(Lenovo)C1530éŸ³ç®±éŸ³å“ç”µè„‘å°å¼æœºç¬”è®°æœ¬ç”µè„‘éŸ³ç®±å¥—è£…ä½éŸ³ç‚®ã€‘è¿™æ ·çš„åå­—ï¼ŒæŸ¥è¯¢ã€è”æƒ³ç¬”è®°æœ¬ã€‘å°±å¯ä»¥æŸ¥å‡ºæ¥\nif(!empty($keyword)){\n        $i = 0;\n        $where .= \" and g_name like '\";\n        while(mb_substr($keyword,$i, 1, 'utf-8')){\n            $str = mb_substr($keyword, $i, 1, 'utf-8');\n            $where .= \"%{$str}\";\n            $i++;\n        }\n        $where .= \"%'\";\n    }\n````\n","tags":["Php","Mysql"],"categories":["éšç¬”"]},{"title":"Mysqlå ä½æŸ¥è¯¢","url":"/tech-notes/mysql-1551078249.html","content":"````\n$sql = \"SELECT id,name FROM table WHERE 1\"\nå‡å¦‚æˆ‘è¦åœ¨idå’Œnameä¹‹é—´æ’å…¥ä¸€åˆ—ï¼Œè¿˜ä¸æƒ³é‡ç»„æ•°æ®ï¼Œé‚£å°±å¯ä»¥åœ¨æŸ¥è¯¢çš„æ—¶å€™å ä½\n$sql = \"SELECT id,(@title :='') title,name FROM table WHERE 1\"\n$row = db_arr($sql)\nè¿™æ ·æŸ¥å®Œåï¼Œéå†ç»™titleèµ‹å€¼\nforeach($row as $v){\n    $v['title'] = \n}\n#å¼ºåˆ¶ä½¿ç”¨ç´¢å¼•--ä¸çŸ¥é“ä¸ºå•¥ä¸èµ°ç´¢å¼•ã€‚ã€‚ã€‚\nSELECT * from member_order FORCE INDEX(ctime) where ctime>='1546272000'\n````","tags":["Php","Mysql"],"categories":["éšç¬”"]},{"title":"Jstreeä½¿ç”¨è®°å½•","url":"/tech-notes/jstree-1550931747.html","content":"````\n$(\"#treeview\").jstree({\n            \"themes\": {\"stripes\": true},\n            \"checkbox\": {\n                \"keep_selected_style\": false,\n            },\n            \"types\": {\n                \"root\": {\n                    \"icon\": \"fa fa-folder-open\",\n                },\n                \"menu\": {\n                    \"icon\": \"fa fa-folder-open\",\n                },\n                \"file\": {\n                    \"icon\": \"fa fa-file-o\",\n                }\n            },\n            \"plugins\": [\"checkbox\", \"types\"],\n            \"core\": {\n                'check_callback': true,\n                \"data\": {{$tree}}\n    }\n    });\n        //è¯»å–é€‰ä¸­çš„æ¡ç›®\n        $.jstree.core.prototype.get_all_checked = function (full) {\n            var obj = this.get_selected(), i, j;\n            for (i = 0, j = obj.length; i < j; i++) { obj = obj.concat(this.get_node(obj[i]).parents); } obj = $.grep(obj, function (v, i, a) { return v != '#'; }); obj = obj.filter(function (itm, i, a) { return i == a.indexOf(itm); }); return full ? $.map(obj, $.proxy(function (i) { return this.get_node(i); }, this)) : obj; }; // if ($(\"#treeview\").size() > 0) {\n//            var r = $(\"#treeview\").jstree(\"get_all_checked\");\n//            $(\"input[name='a_power']\").val(r.join(','));\n//        }\n        //å…¨é€‰å’Œå±•å¼€\n        $(document).on(\"click\", \"#checkall\", function () {\n            $(\"#treeview\").jstree($(this).prop(\"checked\") ? \"check_all\" : \"uncheck_all\");\n        });\n        $(document).on(\"click\", \"#expandall\", function () {\n            $(\"#treeview\").jstree($(this).prop(\"checked\") ? \"open_all\" : \"close_all\");\n        });\n        $(\"#treeview\").on(\"ready.jstree\", function (e, obj) {   //æ ‘åˆ›å»ºå®Œæˆäº‹ä»¶\n            //obj.instance.open_all();    //å±•å¼€æ‰€æœ‰èŠ‚ç‚¹\n        });\n        $(\"#treeview\").on('changed.jstree', function (e, data) {   //é€‰ä¸­èŠ‚ç‚¹æ”¹å˜äº‹ä»¶\n            //è·å–æ‰€æœ‰é€‰ä¸­é¡¹ç›®åŠå­é¡¹ç›®\n            var r = $(\"#treeview\").jstree(\"get_all_checked\");\n            $(\"input[name='a_power']\").val(r.join(','));\n        });\n````\n","tags":["Javascript"],"categories":["éšç¬”"]},{"title":"Excelæ—¶é—´æˆ³è½¬æ¢æ—¥æœŸ","url":"/tech-notes/excel_time-1550931509.html","content":"æœ‰æ—¶å€™ç›´æ¥å¯¼å‡ºæ•°æ®åº“æ•°æ®ï¼Œæ—¶é—´æ˜¯æ—¶é—´æˆ³æ ¼å¼çš„è¯çœ‹èµ·æ¥ä¸æ–¹ä¾¿ï¼Œæœ‰äº†ä¸‹é¢å…¬å¼\n> =TEXT((C4/1000+8*3600)/86400+70*365+19,\"yyyy-mm-dd hh:mm:ss\")\nC4ä¸ºæ—¶é—´æˆ³å•å…ƒæ ¼ï¼ˆå•ä½æ¯«ç§’ï¼Œç§’ä¸ç”¨/1000ï¼‰","tags":["Excel"],"categories":["éšç¬”"]},{"title":"SqlæŸ¥æ‰¾é‡å¤æ•°æ®ï¼Œå¹¶ä¿ç•™ä¸€æ¡","url":"/tech-notes/sql-1550807545.html","content":"````\n#æŸ¥è¯¢é‡å¤æ•°æ®ï¼Œå’Œé‡å¤æ¬¡æ•°\nselect id,count(*) as count from table group by é‡å¤å­—æ®µ having count>1;\n#è¿™é‡Œä¿ç•™IDæœ€å¤§ä¸€æ¡è®°å½•\nDelete FROM table Where id Not In (SELECT a.id FROM (Select Max(id) id From table Group By é‡å¤å­—æ®µ) a)\n````\næ”¹ä¸€æ”¹ï¼Œæ€»ä¼šé€‚åˆä½ ","tags":["Mysql"],"categories":["éšç¬”"]},{"title":"æ•°æ®è¡¨2æ¡æ•°æ®ç›¸é‚»çš„æ—¶é—´å·®","url":"/tech-notes/sql-1550807208.html","content":"````\nfunction run(){\n    $start = date('Ymd');\n    $sql = \"SELECT A.f_id,A.f_mid,A.f_ctime,B.f_ctime,(B.f_ctime-A.f_ctime) diff FROM\n(SELECT f_id,f_mid,f_ctime,(@i := @i + 1) as ord_num from member_fangwen_log a,(select @i := 1) d WHERE f_date={$start} AND f_shichang<0 order by f_mid limit 5000) A\nLEFT JOIN\n(SELECT f_id,f_mid,f_ctime,(@j := @j + 1) as ord_num from member_fangwen_log a,(select @j := 0) c WHERE f_date={$start} AND f_shichang<0 order by f_mid limit 5000) B\non A.ord_num=B.ord_num AND A.f_mid=B.f_mid\";\n    $rows = db_arr($sql);\n    foreach ($rows as $val){\n        !empty($val['diff'])?$val['diff']:$val['diff']=0;\n        $sql = \"UPDATE member_fangwen_log SET f_shichang={$val['diff']} WHERE f_id={$val['f_id']} AND f_shichang<0 limit 1\";\n        $res = db_exec($sql);\n    }\n}\n````\nå¯ä»¥è®¡ç®—å‡ºæ¯ä¸ªç”¨æˆ·ç›¸é‚»2æ¡è®¿é—®è®°å½•ä¹‹é—´çš„æ—¶é•¿","tags":["Mysql"],"categories":["éšç¬”"]},{"title":"å›¾ç‰‡ä¸Šä¼ é¢„è§ˆ","url":"/tech-notes/upload-1550806771.html","content":"````\n//è¿™é‡Œæ˜¯é€‰æ‹©å›¾ç‰‡çš„æ“ä½œ\n$('#image').change(function () {\n        var pattern = /(\\.*.jpg$)|(\\.*.png$)|(\\.*.gif$)|(\\.*.jpeg)/;\n        if (!pattern.test($(this).val())) {\n            $('#toast').modal('show');\n            $('.modtis').text('ç³»ç»Ÿä»…æ”¯æŒjpg/png/gifæ ¼å¼çš„ç…§ç‰‡ï¼');\n            this.focus();\n            $(this).val(\"\");\n            return false;\n        }\n        var file = $(this)[0].files[0];\n        var path = getObjectURL(file);\n        $('#img-thumbnail').attr('src',path);\n    });\n//è¿™ä¸ªå‡½æ•°ä¸ºä¸åŒæµè§ˆå™¨è·å–å›¾ç‰‡è·¯å¾„\nfunction getObjectURL(file) {\n    var url = null;\n    if (window.createObjectURL != undefined) { // basic\n        url = window.createObjectURL(file);\n    } else if (window.URL != undefined) { // mozilla(firefox)\n        url = window.URL.createObjectURL(file);\n    } else if (window.webkitURL != undefined) { // webkit or chrome\n        url = window.webkitURL.createObjectURL(file);\n    }\n    return url;\n}\n````","tags":["Javascript"],"categories":["éšç¬”"]},{"title":"Phpä¸‹è½½æœ€æ–°ç‰ˆæœ¬æ–‡ä»¶åˆ°æœ¬åœ°","url":"/tech-notes/php-1550806263.html","content":"æ¯”è¾ƒç‰ˆæœ¬å·ï¼Œç„¶åä¸‹è½½\n````\nif(version_compare($version1,$version2,'<')){\n        $file = $row['a_url'];\n        $filename = basename($file);\n        header(\"Content-type: application/octet-stream\");\n        $ua = $_SERVER[\"HTTP_USER_AGENT\"];\n        $encoded_filename = rawurlencode($filename);\n        if (preg_match(\"/MSIE/\", $ua)) {\n            header('Content-Disposition: attachment; filename=\"' . $encoded_filename . '\"');\n        } else if (preg_match(\"/Firefox/\", $ua)) {\n            header(\"Content-Disposition: attachment; filename*=\\\"utf8''\" . $filename . '\"');\n        } else {\n            header('Content-Disposition: attachment; filename=\"' . $filename . '\"');\n        }\n\n        header(\"Content-Length: \". filesize($file));\n        ob_clean();\n        flush();\n        readfile($file);\n        exit();\n    }\n````\n","tags":["Php"],"categories":["éšç¬”"]},{"title":"Linuxåå°è¿è¡Œphpæ–‡ä»¶","url":"/tech-notes/linux-1550804225.html","content":"å¹³æ—¶ä¼šé‡åˆ°ä¸€æ¬¡æ€§å¤„ç†å¤§é‡æ•°æ®çš„é—®é¢˜ï¼Œè¿™æ˜¯å°±éœ€è¦å†™ä¸ªè„šæœ¬å»åå°è‡ªåŠ¨è¿è¡Œ\n````\nnohup php index.php &\nç›¸å½“äºå®ˆæŠ¤è¿›ç¨‹\n\ntail -f nohup.out\næŸ¥çœ‹è¿è¡Œæƒ…å†µ\n\nps -ef | grep inde.php\næŸ¥çœ‹è¿›ç¨‹\n\nps aux\næŸ¥çœ‹å…¨éƒ¨è¿›ç¨‹\n\nkell -9 [pid]\nç»“æŸè¿›ç¨‹\n````\nå› ä¸ºæˆ‘å†™çš„æ˜¯phpæ–‡ä»¶ï¼Œæ‰€ä»¥éœ€è¦phpç¯å¢ƒ","tags":["Php","Linux"],"categories":["éšç¬”"]},{"title":"å›¾ç‰‡å‹ç¼©ç±»åº“","url":"/tech-notes/image-1550755430.html","content":"ä»Šå¤©è¦æ‰¹é‡å‹ç¼©å›¾ç‰‡ï¼Œç„¶åå°±æœåˆ°äº†ä¸€äº›ç±»å’Œæ–¹æ³•ï¼Œä¿®æ”¹äº†ä¸‹ï¼Œè¯•äº†è¯•ï¼Œéƒ½æŒºä¸é”™ï¼Œè®°å½•ä¸€ä¸‹\n\n#### PHPçš„ç±»\n```\nclass Imgick_tool{\n    //Imagickå¯¹è±¡å®ä¾‹\n    public $obj = null;\n    public function __construct()\n    {\n        //åˆ¤æ–­æ˜¯å¦åŠ è½½äº†è¯¥æ‰©å±•\n        if(!extension_loaded('Imagick'))\n        {\n            return false;\n        }\n        $this->obj = new Imagick();\n    }\n    /*\n\t * png2jpgè½¬æ¢å›¾ç‰‡æ ¼å¼\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n\t * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n\t */\n    public function png2jpg($src_img,$dest_img)\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $this->obj->readImage($src_img);\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * å»æ‰å›¾ç‰‡çš„profileä¿¡æ¯\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @return string src_img å›¾ç‰‡åç§° å¦åˆ™è¿”å›false\n\t */\n    public function strip_profile($src_img,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->stripImage ();\n            if($this->obj->writeImage ($dest_img))\n            {\n                $this->destory();\n                return $src_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n         * è®¾ç½®jpgå›¾ç‰‡è´¨é‡\n         *\n         * @param string src_img æºå›¾ç‰‡è·¯å¾„\n         * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n         * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n         */\n    public function set_quality($src_img,$quality = 70,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->setImageCompression(Imagick::COMPRESSION_JPEG);\n            $this->obj->setImageCompressionQuality($quality);\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n      * å›¾ç‰‡ç˜¦èº«\n      *\n      * @param string src_img æºå›¾ç‰‡è·¯å¾„\n      * @param int quality è®¾ç½®å›¾ç‰‡å‹ç¼©è´¨é‡\n      * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n      * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n      */\n    public function slimming($src_img,$quality = 60,$dest_img = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n            $dest_img = empty($dest_img) ? $src_img : $dest_img;\n            $this->obj->readImage($src_img);\n            $this->obj->setImageFormat('jpeg');\n            $this->obj->setImageCompression(Imagick::COMPRESSION_JPEG);\n            //å°†å›¾ç‰‡çš„è´¨é‡é™ä½åˆ°åŸæ¥çš„60%\n            $quality = $this->obj->getImageCompressionQuality() * $quality / 100;\n            $this->obj->setImageCompressionQuality($quality);\n            $this->obj->stripImage();\n\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * ç”Ÿæˆç¼©ç•¥å›¾\n\t *\n\t * @param string src_img æºå›¾ç‰‡è·¯å¾„\n\t * @param int quality è®¾ç½®å›¾ç‰‡å‹ç¼©è´¨é‡\n\t * @param string dest_img è¦ç”Ÿæˆçš„å›¾ç‰‡çš„è·¯å¾„\n\t * @return boolean è½¬æ¢æˆå…±è¿”å›true  å¦åˆ™false\n\t */\n    public function thump($src_img,$width = 250,$height = '')\n    {\n        if(!is_object($this->obj))\n        {\n            return false;\n        }\n        try\n        {\n\n            $file_info = pathinfo($src_img);\n            //ç”Ÿæˆç¼©ç•¥å›¾åç§°\n            $file_name = substr($file_info['basename'],0,strrpos($file_info['basename'],'.'));\n            $dest_img = $file_info['dirname'] . '/' . $file_name . '_thump.' . $file_info['extension'];\n            $this->obj->readImage($src_img);\n            //è®¡ç®—è¦è·å¾—ç¼©ç•¥å›¾çš„é«˜åº¦\n            $img_width = $this->obj->getImageWidth();\n            $img_height = $this->obj->getImageHeight();\n            $dest_height = $img_height * ($width / $img_width);\n            $this->obj->resizeImage($width, $dest_height, Imagick::FILTER_CATROM, 1, false);\n            //ç”Ÿæˆå›¾ç‰‡\n            if($this->obj->writeImage($dest_img))\n            {\n                $this->destory();\n                return $dest_img;\n            }\n            return false;\n        }\n        catch (ImagickException $e)\n        {\n            return false;\n        }\n    }\n    /*\n\t * é‡Šæ”¾èµ„æº\n\t *\n\t */\n    function destory()\n    {\n        if(is_object($this->obj))\n        {\n            $this->obj->clear();\n\n            $this->obj->destroy();\n        }\n    }\n}\n```\n\n#### Pythonçš„ç±»\n```\n#coding:utf-8\nfrom PIL import Image\nimport os\nfrom Logger import Logger\nimport imghdr\nimport mmap\nfrom PIL import ImageFile\nImageFile.LOAD_TRUNCATED_IMAGES = True\n\n#æ£€æŸ¥æ–‡ä»¶æ˜¯å¦è¢«å‹ç¼©è¿‡\ndef checkImageCompressed(savedFilePath,srcFile):\n    f = open(savedFilePath)\n    s = mmap.mmap(f.fileno(), 0, access=mmap.ACCESS_READ)\n    print(srcFile)\n    if s.find(srcFile.encode()) != -1:\n        #print('true')\n        return True\n    else:\n        return False\n\n#åˆ¤æ–­å›¾ç‰‡æ ¼å¼\ndef checkImageType(srcFile):\n    #print imghdr.what(srcFile)\n    return imghdr.what(srcFile)\n\n\n#åˆ¤æ–­æ˜¯å¦æ˜¯å›¾ç‰‡\ndef isImage(srcFile):\n    suffix = ['jpg','png']\n    #print \"srcFile: \" + srcFile\n    suffix_srcfile = srcFile.lower().split('.')[2]\n    #print \"suffix_srcfile: \" + suffix_srcfile\n    if suffix_srcfile in suffix:\n        return True\n    else:\n        return False\n\n#å›¾ç‰‡å‹ç¼©æ‰¹å¤„ç†\ndef compressImage(srcPath,dstPath,dataPath):\n    for filename in os.listdir(srcPath):  \n        #å¦‚æœä¸å­˜åœ¨ç›®çš„ç›®å½•åˆ™åˆ›å»ºä¸€ä¸ªï¼Œä¿æŒå±‚çº§ç»“æ„\n        if not os.path.exists(dstPath):\n            os.makedirs(dstPath)        \n\n        #æ‹¼æ¥å®Œæ•´çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹è·¯å¾„\n        srcFile=os.path.join(srcPath,filename)\n        ##print(dstPath,filename)\n        dstFile=os.path.join(dstPath,filename)\n        #print srcFile\n        ##print dstFile\n\n        if os.path.isfile(srcFile):\n            if 'small.' in srcFile:\n                #print \"å·²ç»æ˜¯å‹ç¼©æ–‡ä»¶ä¸éœ€è¦å†å‹ç¼©ï¼ï¼\"\n                logger_ignored.debug(srcFile)\n                continue\n            else:\n                dstFile=os.path.join(dstPath,filename.split('.')[0] + '.' + filename.split('.')[1])\n                #print srcFile\n                #print dstFile       \n        #å¦‚æœæ˜¯æ–‡ä»¶å°±å¤„ç†\n        if os.path.isfile(srcFile):\n            if isImage(srcFile):\n                #åˆ¤æ–­æ˜¯å¦æ˜¯tiffæ ¼å¼ï¼Œè¯¥æ ¼å¼æš‚ä¸æ”¯æŒ\n                if checkImageType(srcFile) == 'tiff':\n                    logger_errored.debug(\"-----start the File is tiff, ignore this file.-----\")\n                    logger_errored.debug(srcFile)\n                    logger_errored.debug(\"-----end the File is tiff, ignore this file.-----\")\n                    continue\n\n                #æ£€æŸ¥æ˜¯å¦å‹ç¼©è¿‡\n                if checkImageCompressed(dataPath,srcFile):\n                    logger_ignored.debug(srcFile)\n                    continue\n                try:\n                    #æ‰“å¼€åŸå›¾ç‰‡ç¼©å°åä¿å­˜ï¼Œå¯ä»¥ç”¨if srcFile.endswith(\".jpg\")æˆ–è€…splitï¼Œsplitextç­‰å‡½æ•°ç­‰é’ˆå¯¹ç‰¹å®šæ–‡ä»¶å‹ç¼©\n                    logger_compressed.debug(\"-------start compressed-------\")\n                    logger_compressed.debug(srcFile)\n                    sImg=Image.open(srcFile)  \n                    w,h=sImg.size\n                    logger_compressed.debug(\"src File fomatter: \" + str(w) + \"X\" + str(h) + \"px\")\n                    #print w,h\n                    dImg=sImg.resize((w,h),Image.ANTIALIAS)  #è®¾ç½®å‹ç¼©å°ºå¯¸å’Œé€‰é¡¹ï¼Œæ³¨æ„å°ºå¯¸è¦ç”¨æ‹¬å·\n                    logger_compressed.debug(\"dest File fomatter: \" + str(w) + \"X\" + str(h) + \"px\")\n                        \n                    #è½¬æ¢æˆRGBæ¨¡å¼\n                    #dImg = dImg.convert('RGB')\n                \n                    \n                    dImg.save(dstFile,\"JPEG\",quality=80) #ä¹Ÿå¯ä»¥ç”¨srcFileåŸè·¯å¾„ä¿å­˜,æˆ–è€…æ›´æ”¹åç¼€ä¿å­˜ï¼Œsaveè¿™ä¸ªå‡½æ•°åé¢å¯ä»¥åŠ å‹ç¼©ç¼–ç é€‰é¡¹JPEGä¹‹ç±»çš„\n                    #print dstFile+\" compressed succeeded\"\n                    logger_compressed.debug(\"-------end compressed-------\")\n                    logger_compressed.debug(\"-------start saved log-------\")\n                    logger_compressed.debug(srcFile)\n                    logger_saved.debug(srcFile)\n                    logger_compressed.debug(\"-------end saved log-------\")\n                except IOError:\n                    print (\"å‹ç¼©é”™è¯¯\")\n                    logger_errored.debug(\"-------start errored-------\")\n                    logger_errored.debug(\"File name: \" + srcFile)\n                    logger_errored.debug(IOError)\n                    logger_errored.debug(\"-------end errored-------\")\n                \n        #å¦‚æœæ˜¯æ–‡ä»¶å¤¹å°±é€’å½’\n        if os.path.isdir(srcFile):\n            compressImage(srcFile,dstFile,dataPath)\n\nif __name__=='__main__':\n    #è®°å½•æ—¥å¿—å¹¶ä¿å­˜åˆ°æ—¥å¿—æ–‡ä»¶\n    logger_compressed = Logger(logname='log/compressed_debug.log', loglevel=1, logger=\"compressedImage\").getlog()\n    logger_saved = Logger(logname='log/compressed_saved.log', loglevel=5, logger=\"compressSucceededImage\").getlog()\n    logger_ignored = Logger(logname='log/compressed_ignored.log', loglevel=1, logger=\"compressIgnoredImage\").getlog()\n    logger_errored = Logger(logname='log/compressed_error.log', loglevel=1, logger=\"compressErroredImage\").getlog()\n    compressImage(\"./img\",\"./image\",\"data/compressed_saved.log\")\n```\nè®°å½•æ—¥å¿—çš„ç±»\n```\n# -*- coding: utf-8 -*-\nimport logging\n\n#å¼€å‘ä¸€ä¸ªæ—¥å¿—ç³»ç»Ÿï¼Œ æ—¢è¦æŠŠæ—¥å¿—è¾“å‡ºåˆ°æ§åˆ¶å°ï¼Œ è¿˜è¦å†™å…¥æ—¥å¿—æ–‡ä»¶   \nclass Logger():\n    def __init__(self, logname, loglevel, logger):\n        '''\n           æŒ‡å®šä¿å­˜æ—¥å¿—çš„æ–‡ä»¶è·¯å¾„ï¼Œæ—¥å¿—çº§åˆ«ï¼Œä»¥åŠè°ƒç”¨æ–‡ä»¶\n           å°†æ—¥å¿—å­˜å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­\n        '''\n        format_dict = {\n           1 : logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s'),\n           2 : logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s'),\n           3 : logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s'),\n           4 : logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s'),\n           5 : logging.Formatter('%(message)s')\n        }\n        \n\n        # åˆ›å»ºä¸€ä¸ªlogger\n        self.logger = logging.getLogger(logger)\n        self.logger.setLevel(logging.DEBUG)\n\n        # åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºå†™å…¥æ—¥å¿—æ–‡ä»¶\n        fh = logging.FileHandler(logname)\n        fh.setLevel(logging.DEBUG)\n\n        # å†åˆ›å»ºä¸€ä¸ªhandlerï¼Œç”¨äºè¾“å‡ºåˆ°æ§åˆ¶å°\n        ch = logging.StreamHandler()\n        ch.setLevel(logging.DEBUG)\n\n        # å®šä¹‰handlerçš„è¾“å‡ºæ ¼å¼\n        #formatter = logging.Formatter('%(asctime)s - %(name)s - %(levelname)s - %(message)s')\n        formatter = format_dict[int(loglevel)]\n        fh.setFormatter(formatter)\n        ch.setFormatter(formatter)\n\n        # ç»™loggeræ·»åŠ handler\n        self.logger.addHandler(fh)\n        self.logger.addHandler(ch)\n\n    \n    def getlog(self):\n        return self.logger\n\n##if __name__=='__main__':  \n##    logger = Logger(logname='log.txt', loglevel=1, logger=\"fox\").getlog()\n##    logger.debug(\"foobar\")    # ä¸è¾“å‡º   \n##    logger.info(\"foobar\")        # è¾“å‡º  \n##    logger.warning(\"foobar\")  # è¾“å‡º  \n##    logger.error(\"foobar\")      # è¾“å‡º  \n##    logger.critical(\"foobar\")    # è¾“å‡º  \n```","tags":["Php","Python"],"categories":["éšç¬”"]},{"title":"Hexoåˆå­¦","url":"/tech-notes/hexo-1550644998.html","content":"#### ç‰¹åˆ«æ„Ÿè°¢\n\nç¬¬ä¸€æ¬¡ä½¿ç”¨hexoå»ºç«™ï¼Œæ„Ÿè°¢**[hexo](https://hexo.bootcss.com/)ï¼Œè™½ç„¶çœ‹äº†æ–‡æ¡£å¯¹ä¸€äº›æ“ä½œè¿˜æ˜¯å¾ˆè¿·ç³Šï¼æœ€è¦æ„Ÿè°¢**[è¯´IT](https://shuoit.net)ä½œè€…â€”â€”[å”å…ˆæ£®](https://about.tangkunyin.com)ï¼Œæˆ‘å®Œå…¨æŠŠå”å…ˆæ£®çš„ä»£ç æ¬äº†ä¸‹æ¥ï¼Œç„¶åè¿›è¡Œäº†ç ”ç©¶ä¿®æ”¹ï¼Œæ‰æ‡‚å¾—äº†ä¸€ç‚¹ç‚¹è¦æ€ä¹ˆæ“ä½œï¼ğŸ˜‚ï¼Œå¸Œæœ›å”å…ˆæ£®è€å“¥ä¸è¦ä»‹æ„ã€‚\n\n#### è¸©çš„å‘\n\næœ€å¤§çš„å‘ï¼Œå°±æ˜¯ **menu** è¿™å—äº†\n\n````\nmenu:\n   éšç¬”: tech-notes\n   äººæ–‡: humanities\n   å…¶ä»–: others\n````\n\nä¿®æ”¹åè€æ˜¯æ‰¾ä¸åˆ°é¡µé¢ï¼Œæœ€åå‘ç°è¦å…ˆè¿è¡Œå¦‚ä¸‹å‘½ä»¤\n>hexo new post xxx (æ–‡ç« åç§°)\n>>é»˜è®¤å°±å¯ä»¥è®¿é—® **tech-notes** è¿™ä¸ªèœå•ï¼Œæš‚æ—¶è¿˜ä¸çŸ¥é“å¦‚ä½•ç”Ÿæˆæ–‡ç« åˆ° **humanities,others** ä¸‹ï¼Œå¤±è´¥ï¼ğŸ˜±\n>> è®¿é—®humanitiesï¼Œå°±æŠŠcategoriesæ”¹æˆäººæ–‡ï¼Œç„¶åå°±å¯ä»¥æ„‰å¿«çš„è®¿é—®äº†\n\nå·¦è¾¹èœå•çš„è¯ï¼Œè¿è¡Œå¦‚ä¸‹å‘½ä»¤\n>hexo new page xxx (æ–°é¡µé¢)\n\n#### ç²—æš´ä¿®æ”¹è¯„è®º\n\nå®‰è£…åå‘ç°è¯„è®ºæ˜¾ç¤ºä¸å‡ºæ¥ï¼Œç½‘ä¸ŠæŸ¥çœ‹åï¼Œè¯´æ˜¯è¢«å¢™äº†ï¼Œç„¶åç™¾åº¦äº†æ–°çš„è¯„è®ºæ’ä»¶ï¼Œå°±æ˜¯**[Valine](https://valine.js.org/)\n1. å‰å¾€[Leancloud](https://leancloud.cn)ï¼Œæ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œåˆ›å»ºåº”ç”¨ã€‚\n2. ä¸»é¢˜é…ç½®æ–‡ä»¶é‡Œå¢åŠ ä¸‹é¢ä¿¡æ¯\n````\ncomments:\n  enable: true #\n  appId:  #your leancloud appId\n  appKey: #your leancloud appKey\n  guest_info: nick,mail,link #valine comment header info\n  placeholder: å‹å–„äº¤æµï¼Œä¸å–œå‹¿å–· # valine comment input placeholder(like: Please leave your footprints )\n  avatar: mm # gravatar style https://valine.js.org/avatar\n  pageSize: 10 # comment list page size\n  verify: false # valine verify code (true/false)\n  notify: false # valine mail notify (true/false)\n  lang: zh-cn\n````\n3. åˆ°layout->_partialä¸‹ä¿®æ”¹comments.ejsï¼Œä¿®æ”¹å¦‚ä¸‹\n````\n<% if (theme.comments.enable){ %>\n<section id=\"comments\">\n    <div id=\"valine_thread\" style=\"margin: 30px;\"></div>\n    <script src=\"//cdn1.lncld.net/static/js/3.0.4/av-min.js\"></script>\n    <script src=\"//unpkg.com/valine/dist/Valine.min.js\"></script>\n    <script>\n        var GUEST_INFO = ['nick','mail','link'];\n        var guest_info = '<%= theme.comments.guest_info %>'.split(',').filter(function(item){\n            return GUEST_INFO.indexOf(item) > -1\n        });\n        var notify = '<%= theme.comments.notify %>' == true;\n        var verify = '<%= theme.comments.verify %>' == true;\n        var valine = new Valine();\n        valine.init({\n            el: '#valine_thread',\n            notify: notify,\n            verify: verify,\n            appId: \"<%= theme.comments.appId %>\",\n            appKey: \"<%= theme.comments.appKey %>\",\n            placeholder: \"<%= theme.comments.placeholder %>\",\n            pageSize:'<%= theme.comments.pageSize %>',\n            avatar:'<%= theme.comments.avatar %>',\n            lang:'<%= theme.comments.lang %>'\n        })\n    </script>\n</section>\n<% } %>\n````\n\n#### å¼ºåˆ¶ä½¿ç”¨httpsè®¿é—®\n\nè¿›å…¥gitä»“åº“ï¼Œç‚¹å‡»æœ€å³è¾¹çš„Settingsï¼Œå¦‚ä¸‹å›¾\n![Image text](../img/2019/setting-https.png)\n\nç°åœ¨å¯ä»¥æ„‰å¿«çš„è‡ªå®šä¹‰äº†ï¼Œå†æ¬¡æ„Ÿè°¢ [å”å…ˆæ£®](https://about.tangkunyin.com)","tags":["Hexo","ç½‘ç«™"],"categories":["éšç¬”"]}]